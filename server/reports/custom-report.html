<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:35,&quot;tests&quot;:82,&quot;passes&quot;:82,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2023-05-04T16:28:23.054Z&quot;,&quot;end&quot;:&quot;2023-05-04T16:28:41.877Z&quot;,&quot;duration&quot;:18823,&quot;testsRegistered&quot;:82,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;35edcaf8-7125-4adb-be89-6553ae2d47bb&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;12e83c09-9cc3-4a46-a475-3a4e14f2c262&quot;,&quot;title&quot;:&quot;Blog&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4cc29812-53d9-4ec5-939e-d88c2f068517&quot;,&quot;title&quot;:&quot;postBlog&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog \&quot;before each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {\n  body: {\n    userToken: \&quot;validToken\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\n// Mocking adminJWT, adminDB, and blog objects\nadminJWT = {\n  verifyToken: stub(),\n};\nadminDB = {\n  insertOne: stub(),\n  blog: {},\n};\ntestBlog = new Blog(adminDB, adminJWT);\n// Importing the postBlog function&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8f36582d-53d7-44cb-8ecf-91054b9e790c&quot;,&quot;parentUUID&quot;:&quot;4cc29812-53d9-4ec5-939e-d88c2f068517&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog \&quot;after each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5e39f114-b065-41f4-bbed-26c96dbc5166&quot;,&quot;parentUUID&quot;:&quot;4cc29812-53d9-4ec5-939e-d88c2f068517&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post a blog and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog should post a blog and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return handle and type\nadminJWT.verifyToken.returns({ handle: handle, type: type });\n// Stubbing adminDB.insertOne to return data\nadminDB.insertOne.returns({});\n// Calling the postBlog function\nawait testBlog.postBlog(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  adminDB.insertOne.calledOnceWith(adminDB.blog, match.instanceOf(blog))\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({ success: true, message: \&quot;Blog posted.\&quot; })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;26362cea-0465-4a47-907d-78da677792bf&quot;,&quot;parentUUID&quot;:&quot;4cc29812-53d9-4ec5-939e-d88c2f068517&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle TokenExpiredError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog should handle TokenExpiredError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw TokenExpiredError\nadminJWT.verifyToken.throws(new TokenExpiredError(\&quot;Token expired\&quot;));\n// Calling the postBlog function\nawait testBlog.postBlog(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8d648133-0af8-4a84-9af2-74b05dadc8c2&quot;,&quot;parentUUID&quot;:&quot;4cc29812-53d9-4ec5-939e-d88c2f068517&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog should handle other errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(\&quot;Some error\&quot;));\n// Calling the postBlog function\nawait testBlog.postBlog(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Blog posting failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;691c0d3a-3f4d-4060-9026-cf8594738dab&quot;,&quot;parentUUID&quot;:&quot;4cc29812-53d9-4ec5-939e-d88c2f068517&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;26362cea-0465-4a47-907d-78da677792bf&quot;,&quot;8d648133-0af8-4a84-9af2-74b05dadc8c2&quot;,&quot;691c0d3a-3f4d-4060-9026-cf8594738dab&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6a398b48-bc6b-4449-97ce-5b29641a935b&quot;,&quot;title&quot;:&quot;postEditorial&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial \&quot;before each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {\n  body: {\n    userToken: \&quot;validToken\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\n// Mocking adminJWT, adminDB, and editorial objects\nadminJWT = {\n  verifyToken: stub(),\n};\nadminDB = {\n  insertOne: stub(),\n  editorials: \&quot;editorials\&quot;,\n};\ntestEditorial = new Blog(adminDB, adminJWT);\n// Importing the postEditorial function&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb36dae9-eed9-47d8-9ac9-ccf239db5a96&quot;,&quot;parentUUID&quot;:&quot;6a398b48-bc6b-4449-97ce-5b29641a935b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial \&quot;after each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;05cf4576-1e08-4109-8478-63070a1f0f23&quot;,&quot;parentUUID&quot;:&quot;6a398b48-bc6b-4449-97ce-5b29641a935b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post an editorial and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should post an editorial and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return handle and type\nadminJWT.verifyToken.returns({ handle: handle, type: \&quot;1\&quot; });\n// Stubbing adminDB.insertOne to return data\nadminDB.insertOne.returns({});\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  adminDB.insertOne.calledOnceWith(\n    adminDB.editorials,\n    match.instanceOf(editorial)\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({ success: true, message: \&quot;Editorial posted.\&quot; })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f3df74c8-82bf-4889-9be0-41bd9e2a5791&quot;,&quot;parentUUID&quot;:&quot;6a398b48-bc6b-4449-97ce-5b29641a935b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not post an editorial and send unauthorized response for type 0&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should not post an editorial and send unauthorized response for type 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return handle and type\nadminJWT.verifyToken.returns({ handle: handle, type: \&quot;0\&quot; });\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;You are not authorized to post editorials.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2258df61-4b7e-47b1-80ed-69654d4a43f6&quot;,&quot;parentUUID&quot;:&quot;6a398b48-bc6b-4449-97ce-5b29641a935b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle TokenExpiredError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should handle TokenExpiredError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw TokenExpiredError\nadminJWT.verifyToken.throws(new TokenExpiredError(\&quot;Token expired\&quot;));\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5c48fb7f-13a9-4869-8135-b378959e7179&quot;,&quot;parentUUID&quot;:&quot;6a398b48-bc6b-4449-97ce-5b29641a935b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should handle other errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(\&quot;Some error\&quot;));\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Editorial posting failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0f3780ba-b5b3-45a5-8a34-6eeda795241f&quot;,&quot;parentUUID&quot;:&quot;6a398b48-bc6b-4449-97ce-5b29641a935b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should handle other errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(\&quot;Some error\&quot;));\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Editorial posting failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ed5f4c86-e4b9-418d-bda2-658ee07a27f8&quot;,&quot;parentUUID&quot;:&quot;6a398b48-bc6b-4449-97ce-5b29641a935b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f3df74c8-82bf-4889-9be0-41bd9e2a5791&quot;,&quot;2258df61-4b7e-47b1-80ed-69654d4a43f6&quot;,&quot;5c48fb7f-13a9-4869-8135-b378959e7179&quot;,&quot;0f3780ba-b5b3-45a5-8a34-6eeda795241f&quot;,&quot;ed5f4c86-e4b9-418d-bda2-658ee07a27f8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;40646f97-3bb3-421c-913c-d736c0048c04&quot;,&quot;title&quot;:&quot;getBlog&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getBlog\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog getBlog \&quot;before each\&quot; hook in \&quot;getBlog\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {\n  body: {\n    blogId: \&quot;validBlogId1\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\n// Mocking adminDB object\nadminDB = {\n  findOne: stub(),\n  blog: \&quot;blog\&quot;,\n};\n// Importing the getBlogComments function\ntestBlog = new Blog(adminDB, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;be952f5f-935c-4518-8f50-76a80032c1cc&quot;,&quot;parentUUID&quot;:&quot;40646f97-3bb3-421c-913c-d736c0048c04&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get blog comments and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlog should get blog comments and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedComments = [\&quot;comment1\&quot;, \&quot;comment2\&quot;];\n// Stubbing adminDB.findOne to return data with comments\nadminDB.findOne.returns({ comments: expectedComments });\n// Calling the getBlogComments function\nawait testBlog.getBlog(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(\n    adminDB.blog,\n    { _id: new ObjectId(\&quot;validBlogId1\&quot;) },\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    data: { comments: expectedComments },\n    success: true,\n    message: \&quot;Data sent successfully.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;60139421-6c1b-4d1d-8b9a-521165cc4921&quot;,&quot;parentUUID&quot;:&quot;40646f97-3bb3-421c-913c-d736c0048c04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle error and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlog should handle error and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to throw an error\nadminDB.findOne.throws(new Error(\&quot;Some error\&quot;));\n// Calling the getBlogComments function\nawait testBlog.getBlog(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(\n    adminDB.blog,\n    { _id: new ObjectId(\&quot;validBlogId1\&quot;) },\n    \n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Data could not be sent due to some internal error.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e0913173-2791-4bd9-8431-87282637cbc2&quot;,&quot;parentUUID&quot;:&quot;40646f97-3bb3-421c-913c-d736c0048c04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;60139421-6c1b-4d1d-8b9a-521165cc4921&quot;,&quot;e0913173-2791-4bd9-8431-87282637cbc2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;029d6c07-5932-4ade-abc0-a37496d92737&quot;,&quot;title&quot;:&quot;getBlogs&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getBlogs\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogs \&quot;before each\&quot; hook in \&quot;getBlogs\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking res object\nres = {\n  send: stub(),\n};\n// Mocking adminDB object\nadminDB = {\n  find:stub(),\n  blog: &#x27;blog&#x27;,\n};\n// Importing the getBlogs function\ntestBlog = new Blog(adminDB, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9ba9e653-da64-4c11-9e9f-ddf141fcb7f4&quot;,&quot;parentUUID&quot;:&quot;029d6c07-5932-4ade-abc0-a37496d92737&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get blogs and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogs should get blogs and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedBlogs = [&#x27;blog1&#x27;, &#x27;blog2&#x27;];\n// Stubbing adminDB.find to return data with blogs\nadminDB.find.returns(expectedBlogs);\n// Calling the getBlogs function\nawait testBlog.getBlogs({}, res);\n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.blog, {}, { timestamp: -1 }, { comments: 0 })).to.be.true;\nexpect(res.send.calledOnceWith({ data: expectedBlogs, success: true, message: &#x27;Blogs sent successfully.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;65e84d76-9049-4b60-b693-6d4274771e6e&quot;,&quot;parentUUID&quot;:&quot;029d6c07-5932-4ade-abc0-a37496d92737&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle error and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogs should handle error and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.find to throw an error\nadminDB.find.throws(new Error(&#x27;Some error&#x27;));\n// Calling the getBlogs function\nawait testBlog.getBlogs({}, res);\n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.blog, {}, { timestamp: -1 }, { comments: 0 })).to.be.true;\nexpect(res.send.calledOnceWith({ success: false, message: &#x27;Blogs could not be sent due to some internal error.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bf06a105-e1d8-412a-9ed8-bdb38aa91db1&quot;,&quot;parentUUID&quot;:&quot;029d6c07-5932-4ade-abc0-a37496d92737&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;65e84d76-9049-4b60-b693-6d4274771e6e&quot;,&quot;bf06a105-e1d8-412a-9ed8-bdb38aa91db1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;56ef7b27-f0fd-4d2e-bf48-a252ac90c25b&quot;,&quot;title&quot;:&quot;comment&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;comment\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog comment \&quot;before each\&quot; hook in \&quot;comment\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  updateOne: sinon.stub(),\n  blog: &#x27;blog&#x27;,\n}\nadminJWT = {\n  verifyToken: sinon.stub(),\n};\nreq = {\n  body: {\n    userToken: &#x27;testToken&#x27;,\n    Id: &#x27;testId123445&#x27;,\n    entityType: &#x27;blog&#x27;,\n    comment: &#x27;testComment&#x27;,\n    timestamp: Date.now(),\n  },\n};\nres = {\n  send: sinon.spy(),\n};\ncomment = new Blog(adminDB, adminJWT).comment;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;288cc370-4a2a-48b4-aa87-f2b86f09859d&quot;,&quot;parentUUID&quot;:&quot;56ef7b27-f0fd-4d2e-bf48-a252ac90c25b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post a comment to a blog or editorial&quot;,&quot;fullTitle&quot;:&quot;Blog comment should post a comment to a blog or editorial&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodeData = { handle: &#x27;testHandle&#x27; };\nconst updateResult = { modifiedCount: 1 };\nconst expectedComment = {\n  handle: decodeData.handle,\n  comment: req.body.comment,\n  timestamp: req.body.timestamp,\n};\nadminJWT.verifyToken.returns(decodeData);\nadminDB.updateOne.returns(updateResult);\nawait comment(req, res);\nexpect(adminJWT.verifyToken.calledOnce).to.be.true;\nexpect(adminJWT.verifyToken.firstCall.args[0]).to.equal(req.body.userToken);\nexpect(adminDB.updateOne.calledOnce).to.be.true;\n// expect(adminDB.updateOne.firstCall.args[0]).to.equal(adminDB.blog);\n// expect(adminDB.updateOne.firstCall.args[1]).to.deep.equal({\n//   _id: new ObjectId(req.body.Id),\n// });\n// expect(adminDB.updateOne.firstCall.args[2]).to.deep.equal({\n//   $push: {\n//     comments: expectedComment,\n//   },\n// });\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: true,\n  message: &#x27;Comment posted.&#x27;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2da077eb-0c4e-4786-af7e-f81b92a75007&quot;,&quot;parentUUID&quot;:&quot;56ef7b27-f0fd-4d2e-bf48-a252ac90c25b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle token expired errors&quot;,&quot;fullTitle&quot;:&quot;Blog comment should handle token expired errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expiredError = new TokenExpiredError(&#x27;TokenExpiredError&#x27;);\nadminJWT.verifyToken.throws(expiredError);\nawait comment(req, res);\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: &#x27;Token has expired.&#x27;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;91199c1e-24ea-43ee-a1e2-d3fe3f5708b6&quot;,&quot;parentUUID&quot;:&quot;56ef7b27-f0fd-4d2e-bf48-a252ac90c25b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors&quot;,&quot;fullTitle&quot;:&quot;Blog comment should handle other errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = &#x27;Error posting comment&#x27;;\nadminDB.updateOne = sinon.stub().throws(new Error(errorMessage));\nadminJWT.verifyToken.returns({ handle: &#x27;testHandle&#x27; });\nawait comment(req, res);\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: &#x27;Comment cannot be posted due to internal error.&#x27;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;856e61ca-500d-4ffd-81cf-1ce0f053986b&quot;,&quot;parentUUID&quot;:&quot;56ef7b27-f0fd-4d2e-bf48-a252ac90c25b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2da077eb-0c4e-4786-af7e-f81b92a75007&quot;,&quot;91199c1e-24ea-43ee-a1e2-d3fe3f5708b6&quot;,&quot;856e61ca-500d-4ffd-81cf-1ce0f053986b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4ba7b1d3-d1ea-4681-9b46-3b2495285c6d&quot;,&quot;title&quot;:&quot;database&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cfb8fe89-a0f7-4aeb-aada-606c6aa9a7e3&quot;,&quot;title&quot;:&quot;connect&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;fullTitle&quot;:&quot;database connect \&quot;before each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();  \ntestDatabase = new database(uri,databaseName);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d7239dc9-1879-4fb5-8ec9-12c31677127b&quot;,&quot;parentUUID&quot;:&quot;cfb8fe89-a0f7-4aeb-aada-606c6aa9a7e3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;fullTitle&quot;:&quot;database connect \&quot;after each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ea4f5784-ae21-4e4b-8402-75780feaed46&quot;,&quot;parentUUID&quot;:&quot;cfb8fe89-a0f7-4aeb-aada-606c6aa9a7e3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should connect to the database&quot;,&quot;fullTitle&quot;:&quot;database connect should connect to the database&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const consoleSpy = spy(console,\&quot;log\&quot;);\nconst dbMock = {collection : stub()} // mock database collection\nconst clientMock = {\n    connect : stub().resolves() //returns a resolved promise (Which stimulates the condition when database is connected)\n, db : stub().returns(dbMock)}; //returns a mock database\ntestDatabase.client = clientMock;\nawait testDatabase.connect();\nexpect(clientMock.connect.calledOnce).to.be.true;\nexpect(consoleSpy.calledOnce).to.be.true;\nexpect(consoleSpy.firstCall.args[0]).to.equal(\&quot;DB Connection successful\&quot;);\nexpect(clientMock.db.calledWith(databaseName)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Users\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;otp\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Problems\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Blogs\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Editorials\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;SubmittedSolutions\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Solved\&quot;)).to.be.true;\nconsoleSpy.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2805dc2b-5505-43ed-b4de-722b5da61e91&quot;,&quot;parentUUID&quot;:&quot;cfb8fe89-a0f7-4aeb-aada-606c6aa9a7e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2805dc2b-5505-43ed-b4de-722b5da61e91&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4ae495d1-18a0-4e2d-a719-da59bd727fba&quot;,&quot;title&quot;:&quot;findOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database findOne \&quot;before each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b84a5ef-8796-422d-8e27-20c65150de43&quot;,&quot;parentUUID&quot;:&quot;4ae495d1-18a0-4e2d-a719-da59bd727fba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database findOne \&quot;after each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;47287a53-8e52-4917-8c6e-003f151ee9ca&quot;,&quot;parentUUID&quot;:&quot;4ae495d1-18a0-4e2d-a719-da59bd727fba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return a document&quot;,&quot;fullTitle&quot;:&quot;database findOne should return a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21 };\nawait testDatabase.users.insertOne(doc);\n      \n// Call the findOne function with the query object\nconst query = { name: &#x27;user&#x27; };\nconst fields = { age:21, _id:0 };\nconst result = await testDatabase.findOne(testDatabase.users, query, fields);\n      \n// Assert that the result matches the expected document\nexpect (result).to.be.an(&#x27;object&#x27;);\n  expect (result).to.deep.equal({ age:21 });&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b8ddfdbc-ba93-4a06-88d6-06e508ff8166&quot;,&quot;parentUUID&quot;:&quot;4ae495d1-18a0-4e2d-a719-da59bd727fba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b8ddfdbc-ba93-4a06-88d6-06e508ff8166&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6182c6a9-3911-4101-8a6b-095683a8f91e&quot;,&quot;title&quot;:&quot;insertOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database insertOne \&quot;before each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;84c8a350-81d6-4709-a773-f1c318ce4ba9&quot;,&quot;parentUUID&quot;:&quot;6182c6a9-3911-4101-8a6b-095683a8f91e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database insertOne \&quot;after each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;82fcd734-a370-4dcb-bf6d-3396b00ef8c9&quot;,&quot;parentUUID&quot;:&quot;6182c6a9-3911-4101-8a6b-095683a8f91e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should insert a document&quot;,&quot;fullTitle&quot;:&quot;database insertOne should insert a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21 };\nlet insertData = await testDatabase.insertOne(testDatabase.users,doc);\n  // Assert that the result matches the expected document\nexpect (insertData.acknowledged).to.equal(true);\nexpect (insertData.insertedId).to.not.equal(null | undefined);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;37e51958-3bfb-4fac-ac51-3e7f2fcc09ef&quot;,&quot;parentUUID&quot;:&quot;6182c6a9-3911-4101-8a6b-095683a8f91e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;37e51958-3bfb-4fac-ac51-3e7f2fcc09ef&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;27109c42-10fe-421c-a289-4d43b184d37a&quot;,&quot;title&quot;:&quot;updateOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database updateOne \&quot;before each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4adb75be-3722-4946-9713-d83b0f014e2a&quot;,&quot;parentUUID&quot;:&quot;27109c42-10fe-421c-a289-4d43b184d37a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database updateOne \&quot;after each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f9016c37-b518-499e-baec-4307f91d26ee&quot;,&quot;parentUUID&quot;:&quot;27109c42-10fe-421c-a289-4d43b184d37a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return a document&quot;,&quot;fullTitle&quot;:&quot;database updateOne should return a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21,hobby : []};\nawait testDatabase.users.insertOne(doc);\n    \n// Call the findOne function with the query object\nlet query = { name: &#x27;user&#x27; };\nlet result = await testDatabase.updateOne(testDatabase.users, query, {$set : {name: \&quot;newUser\&quot;}});\nexpect(result).to.be.an(&#x27;object&#x27;);\nexpect(result.acknowledged).to.equal(true);\nexpect(result.modifiedCount).to.equal(1);\nquery = { name: &#x27;newUser&#x27; };\nresult = await testDatabase.updateOne(testDatabase.users, query, {$push : {hobby: \&quot;newUser\&quot;}});\nexpect(result).to.be.an(&#x27;object&#x27;);\nexpect(result.acknowledged).to.equal(true);\nexpect(result.modifiedCount).to.equal(1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;340cb708-060a-46a3-b66d-72ada806513f&quot;,&quot;parentUUID&quot;:&quot;27109c42-10fe-421c-a289-4d43b184d37a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;340cb708-060a-46a3-b66d-72ada806513f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f1b75274-1437-4e9f-b1e2-2166dfa4f8fe&quot;,&quot;title&quot;:&quot;deleteOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database deleteOne \&quot;before each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;31d1228f-1847-4847-9344-8a2da423c348&quot;,&quot;parentUUID&quot;:&quot;f1b75274-1437-4e9f-b1e2-2166dfa4f8fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database deleteOne \&quot;after each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cd8d4aa3-2d98-4e46-856e-8034160ffcb6&quot;,&quot;parentUUID&quot;:&quot;f1b75274-1437-4e9f-b1e2-2166dfa4f8fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should delete a document&quot;,&quot;fullTitle&quot;:&quot;database deleteOne should delete a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21};\nawait testDatabase.users.insertOne(doc);\n    \n// Call the findOne function with the query object\nlet query = { name: &#x27;user&#x27; };\nlet result = await testDatabase.deleteOne(testDatabase.users, query);\nexpect(result).to.be.an(&#x27;object&#x27;);\nexpect(result.acknowledged).to.equal(true);\nexpect(result.deletedCount).to.equal(1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5361f4c4-7fe8-4ec8-b61c-a3f71e46acba&quot;,&quot;parentUUID&quot;:&quot;f1b75274-1437-4e9f-b1e2-2166dfa4f8fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5361f4c4-7fe8-4ec8-b61c-a3f71e46acba&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;53191f8d-dcdc-4230-a5d1-e326b3f72dc8&quot;,&quot;title&quot;:&quot;find&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;find\&quot;&quot;,&quot;fullTitle&quot;:&quot;database find \&quot;before all\&quot; hook in \&quot;find\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create a test collection and insert some documents\nmongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.client.connect();\ntestDatabase.users = testDatabase.client.db(testDatabase.database).collection(&#x27;users&#x27;);\nawait testDatabase.users.insertMany([\n  { name: &#x27;user1&#x27;, age: 21 },\n  { name: &#x27;user2&#x27;, age: 22 },\n  { name: &#x27;user3&#x27;, age: 23 },\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;73efd40f-e7f3-465b-866e-71822617229b&quot;,&quot;parentUUID&quot;:&quot;53191f8d-dcdc-4230-a5d1-e326b3f72dc8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;find\&quot;&quot;,&quot;fullTitle&quot;:&quot;database find \&quot;after all\&quot; hook in \&quot;find\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.client.close();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;daee8031-c627-4e3e-a14d-29d19ac1f7d9&quot;,&quot;parentUUID&quot;:&quot;53191f8d-dcdc-4230-a5d1-e326b3f72dc8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should find all documents in the collection&quot;,&quot;fullTitle&quot;:&quot;database find should find all documents in the collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users);\nexpect(docs).to.have.lengthOf(3);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b09e032a-9cef-4097-b391-de815c61951c&quot;,&quot;parentUUID&quot;:&quot;53191f8d-dcdc-4230-a5d1-e326b3f72dc8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should find documents with a query object&quot;,&quot;fullTitle&quot;:&quot;database find should find documents with a query object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users, { name: &#x27;user1&#x27; });\nexpect(docs).to.have.lengthOf(1);\nexpect(docs[0].name).to.equal(&#x27;user1&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;55a5a5ba-0612-4584-ad5e-392542f6b231&quot;,&quot;parentUUID&quot;:&quot;53191f8d-dcdc-4230-a5d1-e326b3f72dc8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should sort documents with a sort object&quot;,&quot;fullTitle&quot;:&quot;database find should sort documents with a sort object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users, {}, { age: -1 });\nexpect(docs).to.have.lengthOf(3);\nexpect(docs[0].name).to.equal(&#x27;user3&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;17ad29e8-af36-4f73-9829-ea60ad180c75&quot;,&quot;parentUUID&quot;:&quot;53191f8d-dcdc-4230-a5d1-e326b3f72dc8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should project documents with a fields object&quot;,&quot;fullTitle&quot;:&quot;database find should project documents with a fields object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users, {}, {}, { name: 1 });\nexpect(docs).to.have.lengthOf(3);\nexpect(docs[0].name).to.exist;\nexpect(docs[0].age).to.not.exist;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f1f1d0b2-f701-4e69-9d4b-771142d73970&quot;,&quot;parentUUID&quot;:&quot;53191f8d-dcdc-4230-a5d1-e326b3f72dc8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b09e032a-9cef-4097-b391-de815c61951c&quot;,&quot;55a5a5ba-0612-4584-ad5e-392542f6b231&quot;,&quot;17ad29e8-af36-4f73-9829-ea60ad180c75&quot;,&quot;f1f1d0b2-f701-4e69-9d4b-771142d73970&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:6,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;de65e24c-b414-4aa2-a6ee-8471eb266ab5&quot;,&quot;title&quot;:&quot;update&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;update\&quot;&quot;,&quot;fullTitle&quot;:&quot;database update \&quot;before all\&quot; hook in \&quot;update\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create a test collection and insert some documents\nmongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.client.connect();\ntestDatabase.users = testDatabase.client.db(testDatabase.database).collection(&#x27;users&#x27;);\nawait testDatabase.users.insertMany([\n  { name: &#x27;user1&#x27;, age: 21,hobby:[] },\n  { name: &#x27;user2&#x27;, age: 22 ,hobby:[]},\n  { name: &#x27;user3&#x27;, age: 23 ,hobby:[]},\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;136d6abd-671b-4346-80ba-7b731331356e&quot;,&quot;parentUUID&quot;:&quot;de65e24c-b414-4aa2-a6ee-8471eb266ab5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;update\&quot;&quot;,&quot;fullTitle&quot;:&quot;database update \&quot;after all\&quot; hook in \&quot;update\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.client.close();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ea0340b5-af38-43ab-9720-ffecb453e199&quot;,&quot;parentUUID&quot;:&quot;de65e24c-b414-4aa2-a6ee-8471eb266ab5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should set some values to all the documents with the required filter&quot;,&quot;fullTitle&quot;:&quot;database update should set some values to all the documents with the required filter&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.update(testDatabase.users, {  }, { $set: { age:50 } });\nexpect(docs.modifiedCount).to.equal(3);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6fd8a5be-a37d-47aa-a3b6-2c861c6868cc&quot;,&quot;parentUUID&quot;:&quot;de65e24c-b414-4aa2-a6ee-8471eb266ab5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should push values in ana array to all the documents with the required filter&quot;,&quot;fullTitle&quot;:&quot;database update should push values in ana array to all the documents with the required filter&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.update(testDatabase.users, { age: {$gt:21} }, { $push: { hobby:\&quot;newHobby\&quot; } });\nexpect(docs.modifiedCount).to.equal(3);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2614eb4b-24b7-43d5-a40a-04bd617193c7&quot;,&quot;parentUUID&quot;:&quot;de65e24c-b414-4aa2-a6ee-8471eb266ab5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6fd8a5be-a37d-47aa-a3b6-2c861c6868cc&quot;,&quot;2614eb4b-24b7-43d5-a40a-04bd617193c7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;31ab5e39-ca4b-442e-9593-deb7b21a8048&quot;,&quot;title&quot;:&quot;Email&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/email.test.js&quot;,&quot;file&quot;:&quot;/test/email.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;31a6c038-0f0a-4952-a168-087a57f3045a&quot;,&quot;title&quot;:&quot;sendMail&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/email.test.js&quot;,&quot;file&quot;:&quot;/test/email.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendMail \&quot;before each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;transporter = nodemailer.createTransport(nodemailerMock());\nemail = new Email();\nemail.transporter = transporter;\nemail.sender = \&quot;test92.test@gmail.com\&quot;;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cf937d56-7ca5-4bed-a6b8-53e941939ed9&quot;,&quot;parentUUID&quot;:&quot;31a6c038-0f0a-4952-a168-087a57f3045a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendMail \&quot;after each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a035bf7c-87c7-41c1-a6ee-f49989ec0a27&quot;,&quot;parentUUID&quot;:&quot;31a6c038-0f0a-4952-a168-087a57f3045a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send an email&quot;,&quot;fullTitle&quot;:&quot;Email sendMail should send an email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// to track the sendMail function of the email.transporter\nconst sendMailSpy = sinon.spy(email.transporter, \&quot;sendMail\&quot;);\nconst receiver = \&quot;nish95.sha@gmail.com\&quot;;\nconst subject = \&quot;Test Email\&quot;;\nconst text = \&quot;This is a test email.\&quot;;\n// call the sendMail function of the email class\nemail.sendMail(receiver, subject, text);\nexpect(sendMailSpy.calledOnce).to.be.true;\nexpect(sendMailSpy.firstCall.args[0]).to.deep.equal({\n  from: email.sender,\n  to: receiver,\n  subject: subject,\n  text: text,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;67f02f27-1fb1-4a3a-bafb-08cc3278ca50&quot;,&quot;parentUUID&quot;:&quot;31a6c038-0f0a-4952-a168-087a57f3045a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should throw the error if the email fails to send&quot;,&quot;fullTitle&quot;:&quot;Email sendMail should throw the error if the email fails to send&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// mock the sendMail function of the email.transporter\nemail.transporter.sendMail = sinon\n  .stub()\n  .yields(\&quot;Failed to send email.\&quot;);\n  // to call the callback function of the sendMail function with the error message\nconst receiver = \&quot;recipient@example.com\&quot;;\nconst subject = \&quot;Test email\&quot;;\nconst text = \&quot;This is a test email.\&quot;;\nconst errorMessage = \&quot;Failed to send email.\&quot;;\nexpect(() =&gt; {\n  email.sendMail(receiver, subject, text);\n}).to.throw(Error, errorMessage);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c9137091-930e-40e7-8369-e6d993f6a940&quot;,&quot;parentUUID&quot;:&quot;31a6c038-0f0a-4952-a168-087a57f3045a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;67f02f27-1fb1-4a3a-bafb-08cc3278ca50&quot;,&quot;c9137091-930e-40e7-8369-e6d993f6a940&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3b7c1416-edbf-4541-b222-ee10a80cbbb0&quot;,&quot;title&quot;:&quot;sendOTP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/email.test.js&quot;,&quot;file&quot;:&quot;/test/email.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendOTP \&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;transporter = nodemailer.createTransport(nodemailerMock());\nemail = new Email();\nemail.transporter = transporter;\nemail.sender = \&quot;test92.test@gmail.com\&quot;;\nemail.sendMail = sinon.stub().resolves();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;507b8c82-f6d7-4f5a-97a7-5f787f686749&quot;,&quot;parentUUID&quot;:&quot;3b7c1416-edbf-4541-b222-ee10a80cbbb0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendOTP \&quot;after each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;911d1c3b-cd99-42ac-a6de-67680680cba0&quot;,&quot;parentUUID&quot;:&quot;3b7c1416-edbf-4541-b222-ee10a80cbbb0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send an OTP&quot;,&quot;fullTitle&quot;:&quot;Email sendOTP should send an OTP&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const receiver = \&quot;nish95.sha@gmail.com\&quot;;\nconst otp = \&quot;123456\&quot;;\nemail.sendOTP(receiver, otp);\nexpect(\n  email.sendMail.calledOnceWithExactly(\n    receiver,\n    \&quot;OTP\&quot;,\n    `Your OTP is ${otp}`\n  )\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6e3747ca-b68c-4c8f-a474-3728f10c6c45&quot;,&quot;parentUUID&quot;:&quot;3b7c1416-edbf-4541-b222-ee10a80cbbb0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6e3747ca-b68c-4c8f-a474-3728f10c6c45&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d486a108-6a39-4598-9b57-99ac42281864&quot;,&quot;title&quot;:&quot;Problems&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;168f4e7d-48d2-4707-bdb9-b7c83846c97a&quot;,&quot;title&quot;:&quot;handleCPP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;handleCPP\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems handleCPP \&quot;before each\&quot; hook in \&quot;handleCPP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;res = {\n  send: sinon.stub(),\n};\nadminDB = {\n  findOne: sinon.stub(),\n  insertOne: sinon.stub(),\n  updateOne: sinon.stub(),\n};\ntestProblem = new Problem(adminDB, {});\nproblemId = \&quot;644bc03d00e76ef0f3d3137f\&quot;;\ncode = `int sum(int a, int b) {return a+b;}`;\nlanguage = \&quot;C++\&quot;;\nhandle = \&quot;testHandle\&quot;;\ntimestamp = \&quot;timastamp\&quot;;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6fd47bb6-384c-414a-a24a-0fc67b7e2791&quot;,&quot;parentUUID&quot;:&quot;168f4e7d-48d2-4707-bdb9-b7c83846c97a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return accept for correct solution&quot;,&quot;fullTitle&quot;:&quot;Problems handleCPP should return accept for correct solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9002,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(0);\nsetTimeout(done, 9000);\nadminDB.findOne.onFirstCall().returns({\n  _id: new ObjectId(\&quot;644bc03d00e76ef0f3d3137f\&quot;),\n  author_handle: \&quot;nishant_89\&quot;,\n  title: \&quot;Add numbers in an array\&quot;,\n  content: \&quot;Add numbers in an array\&quot;,\n  correct_code_CPP:\n    \&quot;#include &lt;bits/stdc++.h&gt;\\n\&quot; +\n    \&quot;using namespace std;\\n\&quot; +\n    \&quot;int sum(int a,int b){\\n\&quot; +\n    \&quot;    return a+b;\\n\&quot; +\n    \&quot;}\\n\&quot; +\n    \&quot;int main(){\\n\&quot; +\n    &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n    &#x27;\\tfreopen(\&quot;coutput.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;    int t;\\n\&quot; +\n    \&quot;cin&gt;&gt;t;\\n\&quot; +\n    \&quot;while(t--){\\n\&quot; +\n    \&quot;\\t int a,b;\\n\&quot; +\n    \&quot;    cin&gt;&gt;a&gt;&gt;b;\\n\&quot; +\n    &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n    \&quot;}\\n\&quot; +\n    \&quot;   \\n\&quot; +\n    \&quot;    return 0;\\n\&quot; +\n    \&quot;}\&quot;,\n  correct_code_JAVA:\n    \&quot;import java.io.*;\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;public class CorrectCode {\\n\&quot; +\n    \&quot;    public static void main(String[] args) {\\n\&quot; +\n    \&quot;        try {\\n\&quot; +\n    \&quot;            // Open input and output files\\n\&quot; +\n    &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n    &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;coutput.txt\&quot;));\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\t// Read first number from input file\\n\&quot; +\n    \&quot;            String line = reader.readLine();\\n\&quot; +\n    \&quot;            int t = Integer.parseInt(line);\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\twhile(t&gt;0){\\n\&quot; +\n    \&quot;\\t\\t\\tString input = reader.readLine();\\n\&quot; +\n    &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n    \&quot;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n\&quot; +\n    \&quot;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    &#x27;            \\twriter.write(num1+num2+\&quot;\\\\n\&quot;);\\n&#x27; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\t// Close input and output files\\n\&quot; +\n    \&quot;\\t\\t\\tt--;\\n\&quot; +\n    \&quot;\\t\\t}\\n\&quot; +\n    \&quot;\\t\\treader.close();\\n\&quot; +\n    \&quot;            writer.close();\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;        } catch (IOException e) {\\n\&quot; +\n    \&quot;            e.printStackTrace();\\n\&quot; +\n    \&quot;        }\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  time_limit: 1,\n  input_format: \&quot;input\&quot;,\n  output_format: \&quot;output\&quot;,\n  example_input: \&quot;sample_input\&quot;,\n  example_output: \&quot;sample_output\&quot;,\n  function_def_CPP: \&quot;int sum(int a,int b){\\n}\&quot;,\n  input_template_CPP:\n    \&quot;#include &lt;bits/stdc++.h&gt;\\n\&quot; +\n    \&quot;using namespace std;\\n\&quot; +\n    &#x27;#include \&quot;funcDef.h\&quot;\\n&#x27; +\n    \&quot;int main(){\\n\&quot; +\n    &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n    &#x27;\\tfreopen(\&quot;output.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n    \&quot;\\t\\n\&quot; +\n    \&quot;    int t;\\n\&quot; +\n    \&quot;    cin&gt;&gt;t;\\n\&quot; +\n    \&quot;    while(t--){\\n\&quot; +\n    \&quot;\\tint a,b;\\n\&quot; +\n    \&quot;    cin&gt;&gt;a&gt;&gt;b;\\n\&quot; +\n    &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n    \&quot;    }\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;    \\n\&quot; +\n    \&quot;    return 0;\\n\&quot; +\n    \&quot;}\&quot;,\n  function_def_JAVA:\n    \&quot;public class Solution {\\n\&quot; +\n    \&quot;    public static int add(int a, int b) {\\n\&quot; +\n    \&quot;        // Write your code here.\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  input_template_JAVA:\n    \&quot;import java.io.*;\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;public class Func {\\n\&quot; +\n    \&quot;    public static void main(String[] args) {\\n\&quot; +\n    \&quot;        try {\\n\&quot; +\n    \&quot;            // Open input and output files\\n\&quot; +\n    &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n    &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;output.txt\&quot;));\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\t// Read first number from input file\\n\&quot; +\n    \&quot;            String line = reader.readLine();\\n\&quot; +\n    \&quot;            int t = Integer.parseInt(line);\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\twhile(t&gt;0){\\n\&quot; +\n    \&quot;\\t\\t\\tString input = reader.readLine();\\n\&quot; +\n    &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n    \&quot;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n\&quot; +\n    \&quot;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    &#x27;            \\twriter.write(Solution.add(num1,num2)+\&quot;\\\\n\&quot;);\\n&#x27; +\n    \&quot;\\t\\t\\tt--;\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;\\t\\t}\\n\&quot; +\n    \&quot;\\t\\t// Close input and output files\\n\&quot; +\n    \&quot;            \\treader.close();\\n\&quot; +\n    \&quot;            \\twriter.close();\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;        } catch (IOException e) {\\n\&quot; +\n    \&quot;            e.printStackTrace();\\n\&quot; +\n    \&quot;        }\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  testcases: \&quot;5\\n1 3\\n4 6\\n2 0\\n1 -1\\n2 3\&quot;,\n  timestamp: \&quot;2023-04-28T11:21:23.840Z\&quot;,\n  tags: [\&quot;a\&quot;, \&quot;b\&quot;],\n  level: \&quot;medium\&quot;,\n});\nadminDB.findOne.onSecondCall().returns({ problems: [] });\nadminDB.insertOne.returns({});\nadminDB.updateOne.returns({});\ntestProblem.handleCPP(problemId, handle, code, timestamp, language, res);\nsetTimeout(() =&gt; {\n  expect(adminDB.findOne.callCount).to.equal(2);\n}, 9000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5d4352e5-1b31-4ebf-a27f-77f12be405c3&quot;,&quot;parentUUID&quot;:&quot;168f4e7d-48d2-4707-bdb9-b7c83846c97a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5d4352e5-1b31-4ebf-a27f-77f12be405c3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9002,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e761db15-a416-4d44-b9eb-b934e4de87c0&quot;,&quot;title&quot;:&quot;handleJAVA&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;handleJAVA\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems handleJAVA \&quot;before each\&quot; hook in \&quot;handleJAVA\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;res = {\n  send: sinon.stub(),\n};\nadminDB = {\n  findOne: sinon.stub(),\n  insertOne: sinon.stub(),\n  updateOne: sinon.stub(),\n};\ntestProblem = new Problem(adminDB, {});\nproblemId = \&quot;644bc03d00e76ef0f3d3137f\&quot;;\ncode = `public class Solution {public static int add(int a, int b) {return a+b;}}`;\nlanguage = \&quot;Java\&quot;;\nhandle = \&quot;testHandle\&quot;;\ntimestamp = \&quot;timastamp\&quot;;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1fca8e1d-b8c3-42a1-989e-7ae44545e84f&quot;,&quot;parentUUID&quot;:&quot;e761db15-a416-4d44-b9eb-b934e4de87c0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return accept for correct solution&quot;,&quot;fullTitle&quot;:&quot;Problems handleJAVA should return accept for correct solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9002,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(0);\nsetTimeout(done, 9000);\nadminDB.findOne.onFirstCall().returns({\n  _id: new ObjectId(\&quot;644bc03d00e76ef0f3d3137f\&quot;),\n  author_handle: \&quot;nishant_89\&quot;,\n  title: \&quot;Add numbers in an array\&quot;,\n  content: \&quot;Add numbers in an array\&quot;,\n  correct_code_CPP:\n    \&quot;#include &lt;bits/stdc++.h&gt;\\n\&quot; +\n    \&quot;using namespace std;\\n\&quot; +\n    \&quot;int sum(int a,int b){\\n\&quot; +\n    \&quot;    return a+b;\\n\&quot; +\n    \&quot;}\\n\&quot; +\n    \&quot;int main(){\\n\&quot; +\n    &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n    &#x27;\\tfreopen(\&quot;coutput.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;    int t;\\n\&quot; +\n    \&quot;cin&gt;&gt;t;\\n\&quot; +\n    \&quot;while(t--){\\n\&quot; +\n    \&quot;\\t int a,b;\\n\&quot; +\n    \&quot;    cin&gt;&gt;a&gt;&gt;b;\\n\&quot; +\n    &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n    \&quot;}\\n\&quot; +\n    \&quot;   \\n\&quot; +\n    \&quot;    return 0;\\n\&quot; +\n    \&quot;}\&quot;,\n  correct_code_JAVA:\n    \&quot;import java.io.*;\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;public class CorrectCode {\\n\&quot; +\n    \&quot;    public static void main(String[] args) {\\n\&quot; +\n    \&quot;        try {\\n\&quot; +\n    \&quot;            // Open input and output files\\n\&quot; +\n    &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n    &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;coutput.txt\&quot;));\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\t// Read first number from input file\\n\&quot; +\n    \&quot;            String line = reader.readLine();\\n\&quot; +\n    \&quot;            int t = Integer.parseInt(line);\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\twhile(t&gt;0){\\n\&quot; +\n    \&quot;\\t\\t\\tString input = reader.readLine();\\n\&quot; +\n    &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n    \&quot;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n\&quot; +\n    \&quot;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    &#x27;            \\twriter.write(num1+num2+\&quot;\\\\n\&quot;);\\n&#x27; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\t// Close input and output files\\n\&quot; +\n    \&quot;\\t\\t\\tt--;\\n\&quot; +\n    \&quot;\\t\\t}\\n\&quot; +\n    \&quot;\\t\\treader.close();\\n\&quot; +\n    \&quot;            writer.close();\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;        } catch (IOException e) {\\n\&quot; +\n    \&quot;            e.printStackTrace();\\n\&quot; +\n    \&quot;        }\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  time_limit: 1,\n  input_format: \&quot;input\&quot;,\n  output_format: \&quot;output\&quot;,\n  example_input: \&quot;sample_input\&quot;,\n  example_output: \&quot;sample_output\&quot;,\n  function_def_CPP: \&quot;int sum(int a,int b){\\n}\&quot;,\n  input_template_CPP:\n    \&quot;#include &lt;bits/stdc++.h&gt;\\n\&quot; +\n    \&quot;using namespace std;\\n\&quot; +\n    &#x27;#include \&quot;funcDef.h\&quot;\\n&#x27; +\n    \&quot;int main(){\\n\&quot; +\n    &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n    &#x27;\\tfreopen(\&quot;output.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n    \&quot;\\t\\n\&quot; +\n    \&quot;    int t;\\n\&quot; +\n    \&quot;    cin&gt;&gt;t;\\n\&quot; +\n    \&quot;    while(t--){\\n\&quot; +\n    \&quot;\\tint a,b;\\n\&quot; +\n    \&quot;    cin&gt;&gt;a&gt;&gt;b;\\n\&quot; +\n    &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n    \&quot;    }\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;    \\n\&quot; +\n    \&quot;    return 0;\\n\&quot; +\n    \&quot;}\&quot;,\n  function_def_JAVA:\n    \&quot;public class Solution {\\n\&quot; +\n    \&quot;    public static int add(int a, int b) {\\n\&quot; +\n    \&quot;        // Write your code here.\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  input_template_JAVA:\n    \&quot;import java.io.*;\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;public class Func {\\n\&quot; +\n    \&quot;    public static void main(String[] args) {\\n\&quot; +\n    \&quot;        try {\\n\&quot; +\n    \&quot;            // Open input and output files\\n\&quot; +\n    &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n    &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;output.txt\&quot;));\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\t// Read first number from input file\\n\&quot; +\n    \&quot;            String line = reader.readLine();\\n\&quot; +\n    \&quot;            int t = Integer.parseInt(line);\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\twhile(t&gt;0){\\n\&quot; +\n    \&quot;\\t\\t\\tString input = reader.readLine();\\n\&quot; +\n    &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n    \&quot;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n\&quot; +\n    \&quot;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    &#x27;            \\twriter.write(Solution.add(num1,num2)+\&quot;\\\\n\&quot;);\\n&#x27; +\n    \&quot;\\t\\t\\tt--;\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;\\t\\t}\\n\&quot; +\n    \&quot;\\t\\t// Close input and output files\\n\&quot; +\n    \&quot;            \\treader.close();\\n\&quot; +\n    \&quot;            \\twriter.close();\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;        } catch (IOException e) {\\n\&quot; +\n    \&quot;            e.printStackTrace();\\n\&quot; +\n    \&quot;        }\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  testcases: \&quot;5\\n1 3\\n4 6\\n2 0\\n1 -1\\n2 3\&quot;,\n  timestamp: \&quot;2023-04-28T11:21:23.840Z\&quot;,\n  tags: [\&quot;a\&quot;, \&quot;b\&quot;],\n  level: \&quot;medium\&quot;,\n});\nadminDB.findOne.onSecondCall().returns({ problems: [] });\nadminDB.insertOne.returns({});\nadminDB.updateOne.returns({});\ntestProblem.handleJAVA(problemId, handle, code, timestamp, language, res);\nsetTimeout(() =&gt; {\n  expect(adminDB.findOne.callCount).to.equal(2);\n}, 9000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;63fb38e8-ddae-4255-9903-c533b4dde3e2&quot;,&quot;parentUUID&quot;:&quot;e761db15-a416-4d44-b9eb-b934e4de87c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;63fb38e8-ddae-4255-9903-c533b4dde3e2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9002,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b2f2cae5-780b-4e96-aec2-6b2e2832f2fd&quot;,&quot;title&quot;:&quot;postProblem&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;postProblem\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem \&quot;before each\&quot; hook in \&quot;postProblem\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create stubs for adminJWT and adminDB\nadminJWT = {\n  verifyToken: sinon.stub().returns({ handle: &#x27;admin&#x27;, type: &#x27;2&#x27; }),\n};\nadminDB = {\n  insertOne: sinon.stub().returns(true),\n  problem: &#x27;problemCollection&#x27;,\n};\n  \n// Create a fake response object with a send function\nres = {\n  send: sinon.stub(),\n};\npostProblem = new Problem(adminDB,adminJWT).postProblem;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8a94a9ce-b3a9-41bd-b2b5-a40374289c4d&quot;,&quot;parentUUID&quot;:&quot;b2f2cae5-780b-4e96-aec2-6b2e2832f2fd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post a problem successfully&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem should post a problem successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the request object with necessary properties\nconst req = {\n  body: {\n    userToken: &#x27;fakeToken&#x27;,\n    // other properties required by the function\n  },\n};\n  \n  \n// Call the function\nawait postProblem(req, res, adminJWT, adminDB);\n  \n// Verify the expected behavior\n  \n// Verify that adminJWT.verifyToken is called with the correct arguments\nexpect(adminJWT.verifyToken.calledOnce).to.be.true;\nexpect(adminJWT.verifyToken.calledWith(&#x27;fakeToken&#x27;)).to.be.true;\n  \n// Verify that adminDB.insertOne is called with the correct arguments\nexpect(adminDB.insertOne.calledOnce).to.be.true;\nexpect(adminDB.insertOne.calledWith(adminDB.problem, sinon.match.any)).to.be.true;\n  \n// Verify that res.send is called with the correct success message\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.calledWith({ success: true, message: &#x27;Problem posted successfully.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7f946981-f7e7-408a-804d-9ea32e34b864&quot;,&quot;parentUUID&quot;:&quot;b2f2cae5-780b-4e96-aec2-6b2e2832f2fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message if the user is not authorized&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem should return an error message if the user is not authorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the request object with necessary properties\nconst req = {\n  body: {\n    userToken: &#x27;fakeToken&#x27;,\n    // other properties required by the function\n  },\n};\n  \n// Modify the stub for adminJWT to return a different user type\nadminJWT.verifyToken.returns({ handle: &#x27;user&#x27;, type: &#x27;1&#x27; });\n  \n// Import the function to be tested here and pass the stubs and mocks\n  \n// Call the function\nawait postProblem(req, res, adminJWT, adminDB);\n  \n// Verify the expected behavior\n  \n// Verify that adminJWT.verifyToken is called with the correct arguments\nexpect(adminJWT.verifyToken.calledOnce).to.be.true;\nexpect(adminJWT.verifyToken.calledWith(&#x27;fakeToken&#x27;)).to.be.true;\n  \n// Verify that adminDB.insertOne is not called\nexpect(adminDB.insertOne.notCalled).to.be.true;\n  \n// Verify that res.send is called with the correct error message\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.calledWith({\n  success: false,\n  message: &#x27;You are not authorized to post problems.&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2f671673-0c59-4152-a1fe-c4373f7e69bb&quot;,&quot;parentUUID&quot;:&quot;b2f2cae5-780b-4e96-aec2-6b2e2832f2fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle token expiration error&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem should handle token expiration error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the request object with necessary properties\nconst req = {\n  body: {\n    userToken: &#x27;expiredToken&#x27;,\n    // other properties required by the function\n  },\n};\n    // Modify the stub for adminJWT to throw a TokenExpiredError\n    adminJWT.verifyToken.throws(new TokenExpiredError(&#x27;Token expired&#x27;));\n\n    // Import the function to be tested here and pass the stubs and mocks\n\n    // Call the function\n    await postProblem(req, res, adminJWT, adminDB);\n\n    // Verify the expected behavior\n\n    // Verify that adminJWT.verifyToken is called with the correct arguments\n    expect(adminJWT.verifyToken.calledOnce).to.be.true;\n    expect(adminJWT.verifyToken.calledWith(&#x27;expiredToken&#x27;)).to.be.true;\n\n    // Verify that adminDB.insertOne is not called\n    expect(adminDB.insertOne.notCalled).to.be.true;\n\n    // Verify that res.send is called with the correct error message\n    expect(res.send.calledOnce).to.be.true;\n    expect(res.send.calledWith({ success: false, message: &#x27;Token has expired.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;57f9107c-1b40-4c93-8b20-aec7f6653511&quot;,&quot;parentUUID&quot;:&quot;b2f2cae5-780b-4e96-aec2-6b2e2832f2fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle internal server error during problem posting&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem should handle internal server error during problem posting&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the request object with necessary properties\nconst req = {\n  body: {\n    userToken: &#x27;fakeToken&#x27;,\n    // other properties required by the function\n  },\n};\n// Modify the stub for adminDB to return false, indicating an internal server error\nadminDB.insertOne.returns(false);\n// Import the function to be tested here and pass the stubs and mocks\n// Call the function\nawait postProblem(req, res, adminJWT, adminDB);\n// Verify the expected behavior\n// Verify that adminJWT.verifyToken is called with the correct arguments\nexpect(adminJWT.verifyToken.calledOnce).to.be.true;\nexpect(adminJWT.verifyToken.calledWith(&#x27;fakeToken&#x27;)).to.be.true;\n// Verify that adminDB.insertOne is called with the correct arguments\nexpect(adminDB.insertOne.calledOnce).to.be.true;\nexpect(adminDB.insertOne.calledWith(adminDB.problem, sinon.match.any)).to.be.true;\n// Verify that res.send is called with the correct error message\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.calledWith({\n  success: false,\n  message: &#x27;Problem can\\&#x27;t be posted due to internal reasons&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cb064b92-b4e8-4c3c-a1bf-c73743ac0e59&quot;,&quot;parentUUID&quot;:&quot;b2f2cae5-780b-4e96-aec2-6b2e2832f2fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7f946981-f7e7-408a-804d-9ea32e34b864&quot;,&quot;2f671673-0c59-4152-a1fe-c4373f7e69bb&quot;,&quot;57f9107c-1b40-4c93-8b20-aec7f6653511&quot;,&quot;cb064b92-b4e8-4c3c-a1bf-c73743ac0e59&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b852d020-21ee-4971-8239-cf30a8e1398d&quot;,&quot;title&quot;:&quot;fetchSolvedProblems&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fetchSolvedProblems\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems \&quot;before each\&quot; hook in \&quot;fetchSolvedProblems\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminJWT = {\n  verifyToken: sinon.stub().returns({ handle })\n};\n\nreq = { body: { userToken } };\nres = {\n  send: sinon.stub(),\n};\nadminDB = {\n  findOne: sinon.stub().returns({ problems: solvedProblems }),\n  solved: &#x27;solved_collection&#x27;\n};\nfetchSolvedProblems = new Problem(adminDB,adminJWT).fetchSolvedProblems;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6ec6de6f-f240-4b25-966a-01ce05955171&quot;,&quot;parentUUID&quot;:&quot;b852d020-21ee-4971-8239-cf30a8e1398d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should fetch solved problems of user from solved collection&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems should fetch solved problems of user from solved collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await fetchSolvedProblems(req, res);\n    expect(adminJWT.verifyToken.calledOnceWith(userToken)).to.be.true;\n    expect(adminDB.findOne.calledOnceWith(adminDB.solved, { handle }, { problems: 1, _id: 0 })).to.be.true;\n    expect(res.send.calledOnceWith({\n      success: true,\n      problems: solvedProblems,\n      message: &#x27;Solved problems fetched successfully&#x27;\n    })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8309f63d-1f67-44ca-899e-dcb40b990e23&quot;,&quot;parentUUID&quot;:&quot;b852d020-21ee-4971-8239-cf30a8e1398d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error message for token expired error&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems should send error message for token expired error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminJWT.verifyToken= sinon.stub().throws(new TokenExpiredError());\nawait fetchSolvedProblems(req, res);\nexpect(adminJWT.verifyToken.calledOnceWith(userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Token has expired.&#x27;\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;daaa0140-1205-45af-9968-2bfa05b6124f&quot;,&quot;parentUUID&quot;:&quot;b852d020-21ee-4971-8239-cf30a8e1398d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error message for other token errors&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems should send error message for other token errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminJWT.verifyToken= sinon.stub().throws(new JsonWebTokenError());\nawait fetchSolvedProblems(req, res);\nexpect(adminJWT.verifyToken.calledOnceWith(userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;User has logged out.Kindly login again&#x27;\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;394f26ad-bb91-41cb-9cac-74cfc339944a&quot;,&quot;parentUUID&quot;:&quot;b852d020-21ee-4971-8239-cf30a8e1398d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error message for other errors&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems should send error message for other errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne = sinon.stub().throws(new Error(&#x27;Some error occurred&#x27;));    \n  await fetchSolvedProblems(req, res);\n  expect(adminJWT.verifyToken.calledOnceWith(userToken)).to.be.true;\n  expect(adminDB.findOne.calledOnceWith(adminDB.solved, { handle: &#x27;testUser&#x27; }, { problems: 1, _id: 0 })).to.be.true;\n  expect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Some error occurred&#x27;\n  })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0ea13fef-e422-48cd-872d-cfac719c061f&quot;,&quot;parentUUID&quot;:&quot;b852d020-21ee-4971-8239-cf30a8e1398d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8309f63d-1f67-44ca-899e-dcb40b990e23&quot;,&quot;daaa0140-1205-45af-9968-2bfa05b6124f&quot;,&quot;394f26ad-bb91-41cb-9cac-74cfc339944a&quot;,&quot;0ea13fef-e422-48cd-872d-cfac719c061f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c6262372-65e3-49e8-b4e3-09aa54d5d6aa&quot;,&quot;title&quot;:&quot;fetchAllSubmissions&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fetchAllSubmissions\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions \&quot;before each\&quot; hook in \&quot;fetchAllSubmissions\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;res = {\n  send: sinon.stub(),\n};\nadminDB = {\n  find: sinon.stub(),\n  problem: \&quot;problemCollection\&quot;,\n  solution: \&quot;solutionCollection\&quot;,\n}\nadminJWT = {\n  verifyToken: sinon.stub(),\n};\n       fetchAllSubmissions = new Problem(adminDB,adminJWT).fetchAllSubmissions;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9d1bc429-abd5-4fa7-bccb-0cb199d538a4&quot;,&quot;parentUUID&quot;:&quot;c6262372-65e3-49e8-b4e3-09aa54d5d6aa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;fetchAllSubmissions\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions \&quot;after each\&quot; hook in \&quot;fetchAllSubmissions\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e47b001c-0582-46aa-91be-e491451ec7b7&quot;,&quot;parentUUID&quot;:&quot;c6262372-65e3-49e8-b4e3-09aa54d5d6aa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return submissions for a valid token&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions should return submissions for a valid token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminJWT.verifyToken.returns({\n    handle: handle,\n  });\n  const data = [\n    {\n      _id: new ObjectId(),\n      problemId: new ObjectId(),\n      handle: \&quot;testHandle\&quot;,\n      code: \&quot;testCode\&quot;,\n      timestamp: \&quot;testTimestamp\&quot;,\n      language: \&quot;testLanguage\&quot;,\n    },\n  ];\n  adminDB.find.withArgs(adminDB.solution, { handle: handle }).returns(data);\n  const problemData = [\n    {\n      _id: data[0].problemId,\n      title: \&quot;testTitle\&quot;,\n    },\n  ];\n  adminDB.find.withArgs(adminDB.problem, { _id: { $in: [data[0].problemId] } }, {}, { title: 1 })\n    .returns(problemData);\n    \n  await fetchAllSubmissions(req, res);\n    \n  expect(res.send.calledOnce).to.be.true;\n  expect(res.send.firstCall.args[0]).to.deep.equal({\n    success: true,\n    submissions: [\n      {\n        ...data[0],\n        title: problemData[0].title,\n      },\n    ],\n    message: \&quot;Submissions fetched successfully\&quot;,\n  });&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;309b1ba9-4721-4abf-a6a2-d44a0684d4c0&quot;,&quot;parentUUID&quot;:&quot;c6262372-65e3-49e8-b4e3-09aa54d5d6aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message for an invalid token&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions should return an error message for an invalid token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const error = new JsonWebTokenError(\&quot;invalid token\&quot;);\nadminJWT.verifyToken = sinon.stub().throws(error);\n    \nawait fetchAllSubmissions(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;User has logged out.Kindly login again\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f763b6c0-d995-4685-9e48-53a930efe7e3&quot;,&quot;parentUUID&quot;:&quot;c6262372-65e3-49e8-b4e3-09aa54d5d6aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message for an expired token&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions should return an error message for an expired token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const error = new TokenExpiredError(\&quot;expired token\&quot;);\nadminJWT.verifyToken = sinon.stub().throws(error);\n    \nawait fetchAllSubmissions(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Token has expired.\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d8c26f8c-4c99-4cce-a1f4-13c052fd304c&quot;,&quot;parentUUID&quot;:&quot;c6262372-65e3-49e8-b4e3-09aa54d5d6aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message for any other errors&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions should return an error message for any other errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const error = new Error(\&quot;unknown error\&quot;);\nadminDB.find = sinon.stub().throws(error);\nadminJWT.verifyToken.returns({\n  handle: handle,\n});\nawait fetchAllSubmissions(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: error.message,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dabd97c4-ed90-4ca6-8ae3-d055dd3f7318&quot;,&quot;parentUUID&quot;:&quot;c6262372-65e3-49e8-b4e3-09aa54d5d6aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;309b1ba9-4721-4abf-a6a2-d44a0684d4c0&quot;,&quot;f763b6c0-d995-4685-9e48-53a930efe7e3&quot;,&quot;d8c26f8c-4c99-4cce-a1f4-13c052fd304c&quot;,&quot;dabd97c4-ed90-4ca6-8ae3-d055dd3f7318&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e71bbdf4-a717-4ae9-948c-6e91b1b70e35&quot;,&quot;title&quot;:&quot;fetchProblemDetails&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fetchProblemDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchProblemDetails \&quot;before each\&quot; hook in \&quot;fetchProblemDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: sinon.stub(),\n  problem: \&quot;problemCollection\&quot;,\n};\n    \nreq = {\n  body: {\n    problemId: \&quot;someProblemI\&quot;,\n  },\n};\n    \nres = {\n  send: sinon.stub(),\n};\nfetchProblemDetails = new Problem(adminDB,{}).fetchProblemDetails;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f5f5191e-28ca-474f-8b55-e2b83edc0bb7&quot;,&quot;parentUUID&quot;:&quot;e71bbdf4-a717-4ae9-948c-6e91b1b70e35&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return problem details when valid problemId is provided&quot;,&quot;fullTitle&quot;:&quot;Problems fetchProblemDetails should return problem details when valid problemId is provided&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedData = { problem: \&quot;data\&quot; };\nadminDB.findOne.resolves(expectedData);\n    \nawait fetchProblemDetails(req, res, adminDB);\n    \nsinon.assert.calledWith(\n  adminDB.findOne,\n  \&quot;problemCollection\&quot;,\n  { _id: new ObjectId(\&quot;someProblemI\&quot;) },\n  { _id: 0, correct_code_CPP: 0, correct_code_JAVA: 0, testcases: 0 }\n);\n    \nsinon.assert.calledWith(res.send, {\n  success: true,\n  problem: expectedData,\n  message: \&quot;Problem details fetched successfully\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;420bab53-6d50-4f06-8886-0a7ef3518998&quot;,&quot;parentUUID&quot;:&quot;e71bbdf4-a717-4ae9-948c-6e91b1b70e35&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message when an error occurs while fetching the problem details&quot;,&quot;fullTitle&quot;:&quot;Problems fetchProblemDetails should return an error message when an error occurs while fetching the problem details&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedError = new Error(\&quot;Some error occurred\&quot;);\nadminDB.findOne.rejects(expectedError);\n    \nawait fetchProblemDetails(req, res, adminDB);\n    \nsinon.assert.calledWith(res.send, {\n  success: false,\n  message: expectedError.message,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b5544d96-7f31-4902-9b8b-1c0d8d8f538d&quot;,&quot;parentUUID&quot;:&quot;e71bbdf4-a717-4ae9-948c-6e91b1b70e35&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;420bab53-6d50-4f06-8886-0a7ef3518998&quot;,&quot;b5544d96-7f31-4902-9b8b-1c0d8d8f538d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;045f08a8-a0da-4add-b837-55343d4a7b86&quot;,&quot;title&quot;:&quot;fetchAllProblems&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fetchAllProblems\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllProblems \&quot;before each\&quot; hook in \&quot;fetchAllProblems\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  find: sinon.stub(),\n};\nreq = {};\nres = {\n  send: sinon.spy(),\n};\nfetchAllProblems = new Problem(adminDB,{}).fetchAllProblems;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8f720008-a30c-4268-9cfb-c38fd90c360c&quot;,&quot;parentUUID&quot;:&quot;045f08a8-a0da-4add-b837-55343d4a7b86&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should fetch all problems from the problem collection&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllProblems should fetch all problems from the problem collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const data = [{ title: &#x27;Problem 1&#x27;, timestamp: 1234567890 }];\nadminDB.find.returns(data)\n    \nawait fetchAllProblems(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: true,\n  problems: data,\n  message: &#x27;Problems fetched successfully&#x27;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b9e04b7-1546-4966-a322-aaab16f31e95&quot;,&quot;parentUUID&quot;:&quot;045f08a8-a0da-4add-b837-55343d4a7b86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllProblems should handle errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = &#x27;Error fetching problems&#x27;;\nadminDB.find = sinon.stub().throws(new Error(errorMessage));\n    \nawait fetchAllProblems(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: errorMessage,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cbc752a4-4a78-406b-b6d5-fab77ab00ee7&quot;,&quot;parentUUID&quot;:&quot;045f08a8-a0da-4add-b837-55343d4a7b86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4b9e04b7-1546-4966-a322-aaab16f31e95&quot;,&quot;cbc752a4-4a78-406b-b6d5-fab77ab00ee7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;057b58c3-b5de-446a-8d53-ab6a95d8d524&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ff651c6a-d03a-4181-8a79-73823272acf9&quot;,&quot;title&quot;:&quot;userLogin&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogin \&quot;before each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  users: \&quot;users\&quot;,\n  findOne: stub(),\n};\nadminJWT = {\n  createToken: stub(),\n};\nreq = {\n  body: {\n    email: email,\n    password: password,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, adminJWT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a02e9249-224b-471c-972e-61f55aab6f4e&quot;,&quot;parentUUID&quot;:&quot;ff651c6a-d03a-4181-8a79-73823272acf9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogin \&quot;after each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;48f1ba29-1ff8-47ea-b7b6-21b59eb5151c&quot;,&quot;parentUUID&quot;:&quot;ff651c6a-d03a-4181-8a79-73823272acf9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send success response if login is successful&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send success response if login is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:120,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = bcrypt.hashSync(req.body.password, 10);\nadminDB.findOne.resolves({\n  email: req.body.email,\n  password: hashedPassword,\n  type: type,\n  handle: handle,\n});\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nadminJWT.createToken.returns(\&quot;mockToken\&quot;);\nawait user.userLogin(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.calledOnce).to.be.true;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.true;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: true,\n  message: \&quot;Login Successful\&quot;,\n  type: type,\n  userToken: \&quot;mockToken\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b682837b-c18d-4e6c-b8d7-1ce4ac1ba801&quot;,&quot;parentUUID&quot;:&quot;ff651c6a-d03a-4181-8a79-73823272acf9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if password does not match&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send error response if password does not match&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:115,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = bcrypt.hashSync(\&quot;\&quot;, 10);\nadminDB.findOne.resolves({\n  email: req.body.email,\n  password: hashedPassword,\n  type: type,\n  handle: handle,\n});\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nawait user.userLogin(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.calledOnce).to.be.true;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.false;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Invalid Email or Password\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fbe2e412-7728-409f-8ac5-cc0a60b44117&quot;,&quot;parentUUID&quot;:&quot;ff651c6a-d03a-4181-8a79-73823272acf9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.resolves(null);\nawait user.userLogin(req, res);\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.called).to.be.false;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.false;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Invalid Email or Password\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1d78df11-21f5-40da-926b-27076c0d9e18&quot;,&quot;parentUUID&quot;:&quot;ff651c6a-d03a-4181-8a79-73823272acf9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if an error occurs&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send error response if an error occurs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.rejects(new Error(\&quot;Database error\&quot;));\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nawait user.userLogin(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.called).to.be.false;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.false;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Database error\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3d0d6dbb-6cc2-4785-a4a2-8311f4735f6b&quot;,&quot;parentUUID&quot;:&quot;ff651c6a-d03a-4181-8a79-73823272acf9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b682837b-c18d-4e6c-b8d7-1ce4ac1ba801&quot;,&quot;fbe2e412-7728-409f-8ac5-cc0a60b44117&quot;,&quot;1d78df11-21f5-40da-926b-27076c0d9e18&quot;,&quot;3d0d6dbb-6cc2-4785-a4a2-8311f4735f6b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:236,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;662b9c25-df44-481e-8ec9-c21372fea38c&quot;,&quot;title&quot;:&quot;getUserDetails&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails \&quot;before each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  users: \&quot;users\&quot;,\n  findOne: stub(),\n};\nadminJWT = {\n  verifyToken: stub(),\n};\nreq = {\n  body: {\n    userToken: \&quot;mockToken\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, adminJWT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0acdcbae-108d-4789-bb40-ab87c7105a15&quot;,&quot;parentUUID&quot;:&quot;662b9c25-df44-481e-8ec9-c21372fea38c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails \&quot;after each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c59de19-c98e-4a11-ad9a-a08d89446bbb&quot;,&quot;parentUUID&quot;:&quot;662b9c25-df44-481e-8ec9-c21372fea38c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send user details if token is valid and user exists&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send user details if token is valid and user exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodedToken = {\n  email: email,\n};\nadminJWT.verifyToken.returns(decodedToken);\nadminDB.findOne.resolves({ email: decodedToken.email });\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: decodedToken.email },\n    { password: 0, _id: 0 }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;User Details\&quot;,\n    user: { email: decodedToken.email },\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0279b724-d323-4d14-aba5-b1c530b0c416&quot;,&quot;parentUUID&quot;:&quot;662b9c25-df44-481e-8ec9-c21372fea38c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if token is expired&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send error response if token is expired&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tokenExpiredError = new jwt.TokenExpiredError(\&quot;Token has expired\&quot;);\nadminJWT.verifyToken.throws(tokenExpiredError);\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;68ddf757-934c-482d-956a-2e089d37b18f&quot;,&quot;parentUUID&quot;:&quot;662b9c25-df44-481e-8ec9-c21372fea38c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if token is invalid&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send error response if token is invalid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const jsonWebTokenError = new jwt.JsonWebTokenError(\&quot;Invalid token\&quot;);\nadminJWT.verifyToken.throws(jsonWebTokenError);\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User has logged out.Kindly login again\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;33f60b4d-08e3-44a2-86b2-0c6cf286ab3b&quot;,&quot;parentUUID&quot;:&quot;662b9c25-df44-481e-8ec9-c21372fea38c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if an error occurs&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send error response if an error occurs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = \&quot;Database error\&quot;;\nadminJWT.verifyToken.throws(new Error(errorMessage));\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: errorMessage,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;82867080-b4b5-4e9d-9546-f935e965760d&quot;,&quot;parentUUID&quot;:&quot;662b9c25-df44-481e-8ec9-c21372fea38c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0279b724-d323-4d14-aba5-b1c530b0c416&quot;,&quot;68ddf757-934c-482d-956a-2e089d37b18f&quot;,&quot;33f60b4d-08e3-44a2-86b2-0c6cf286ab3b&quot;,&quot;82867080-b4b5-4e9d-9546-f935e965760d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;980fd897-5352-4c03-85a2-f4fe52f86afc&quot;,&quot;title&quot;:&quot;updateProfile&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;fullTitle&quot;:&quot;User updateProfile \&quot;before each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: stub(),\n  updateOne: stub(),\n  users: \&quot;users\&quot;,\n};\nadminJWT = {\n  verifyToken: stub(),\n};\nreq = {\n  body: {\n    userToken: userToken,\n    city: city,\n    birthdate: birthdate,\n    address: address,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, adminJWT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7d1510f5-6bd4-43f9-8735-0fa3e1ca800d&quot;,&quot;parentUUID&quot;:&quot;980fd897-5352-4c03-85a2-f4fe52f86afc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;fullTitle&quot;:&quot;User updateProfile \&quot;after each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6584a349-a960-4f68-a292-6225db290e60&quot;,&quot;parentUUID&quot;:&quot;980fd897-5352-4c03-85a2-f4fe52f86afc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should update profile if user exists and token is valid&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should update profile if user exists and token is valid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodedToken = {\n  email: email,\n};\nadminJWT.verifyToken.returns(decodedToken);\nadminDB.findOne.resolves({ email: decodedToken.email });\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: decodedToken.email,\n  })\n).to.be.true;\nexpect(\n  adminDB.updateOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: decodedToken.email },\n    {\n      $set: {\n        city: req.body.city,\n        birthdate: req.body.birthdate,\n        address: req.body.address,\n      },\n    }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;Profile Updated Successfully\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;94a25195-2bc0-45bb-af16-bee872484ca9&quot;,&quot;parentUUID&quot;:&quot;980fd897-5352-4c03-85a2-f4fe52f86afc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if token is expired&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should send error response if token is expired&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tokenExpiredError = new TokenExpiredError(\&quot;Token has expired\&quot;);\ntokenExpiredError.name = \&quot;TokenExpiredError\&quot;;\nadminJWT.verifyToken.throws(tokenExpiredError);\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b9c93ef7-8b13-4857-ac8c-8ddd2c1cd4fd&quot;,&quot;parentUUID&quot;:&quot;980fd897-5352-4c03-85a2-f4fe52f86afc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if an error occurs during update&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should send error response if an error occurs during update&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = \&quot;Database error\&quot;;\nadminJWT.verifyToken.throws(new Error(errorMessage));\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Profile Updation Failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;add98b79-49b1-47ae-9b97-67c86ae0d6bb&quot;,&quot;parentUUID&quot;:&quot;980fd897-5352-4c03-85a2-f4fe52f86afc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodedToken = {\n  email: \&quot;test@example.com\&quot;,\n};\nadminJWT.verifyToken.returns(decodedToken);\nadminDB.findOne.resolves(null);\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: decodedToken.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User does not exists\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f7a4deef-25ac-43a2-9cc1-53551446b968&quot;,&quot;parentUUID&quot;:&quot;980fd897-5352-4c03-85a2-f4fe52f86afc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;94a25195-2bc0-45bb-af16-bee872484ca9&quot;,&quot;b9c93ef7-8b13-4857-ac8c-8ddd2c1cd4fd&quot;,&quot;add98b79-49b1-47ae-9b97-67c86ae0d6bb&quot;,&quot;f7a4deef-25ac-43a2-9cc1-53551446b968&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;03dc0587-dd20-4166-bd50-d29717e4b52e&quot;,&quot;title&quot;:&quot;fillDetails&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User fillDetails \&quot;before each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: stub(),\n  insertOne: stub(),\n  users: \&quot;users\&quot;,\n};\nreq = {\n  body: {\n    email: email,\n    password: password,\n    name: \&quot;user\&quot;,\n    handle: handle,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c525e08a-acf9-453f-adb9-5b019b317983&quot;,&quot;parentUUID&quot;:&quot;03dc0587-dd20-4166-bd50-d29717e4b52e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User fillDetails \&quot;after each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f364d243-b6fc-4405-bbe8-7a436d725ce7&quot;,&quot;parentUUID&quot;:&quot;03dc0587-dd20-4166-bd50-d29717e4b52e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send error response if user already exists&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if user already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const existingUser = {\n  email: req.body.email,\n};\nadminDB.findOne.resolves(existingUser);\nawait user.fillDetails(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User already exists\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;64e242b3-dd49-4987-972e-2768e7661a15&quot;,&quot;parentUUID&quot;:&quot;03dc0587-dd20-4166-bd50-d29717e4b52e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if any required detail is missing&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if any required detail is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body.email = \&quot;\&quot;;\nreq.body.password = \&quot;\&quot;;\nreq.body.name = \&quot;\&quot;;\nreq.body.handle = \&quot;\&quot;;\nawait user.fillDetails(req, res);\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Please fill all the details.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e42d24b4-1453-45ab-b69d-9db1b5a9925e&quot;,&quot;parentUUID&quot;:&quot;03dc0587-dd20-4166-bd50-d29717e4b52e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if bcrypt hash fails&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if bcrypt hash fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = \&quot;Bcrypt hash failed\&quot;;\nstub(bcrypt, \&quot;hash\&quot;).yields(new Error(errorMessage));\nawait user.fillDetails(req, res);\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User Registration Failed due to some internal error.\&quot;,\n  })\n).to.be.true;\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7efc953a-3ccf-455a-a362-91a33a0561e8&quot;,&quot;parentUUID&quot;:&quot;03dc0587-dd20-4166-bd50-d29717e4b52e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should register the user if all details are provided and user does not exist&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should register the user if all details are provided and user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = \&quot;hashedPassword\&quot;;\nconst newUser = {\n  email: req.body.email,\n  password: hashedPassword,\n  name: req.body.name,\n  handle: req.body.handle,\n  type: \&quot;0\&quot;,\n  city: null,\n  birthdate: null,\n  address: null,\n};\nstub(bcrypt, \&quot;hash\&quot;).callsFake((_password, _len, callback) =&gt; {\n  callback(null, hashedPassword);\n});\nadminDB.findOne.resolves(null);\nawait user.fillDetails(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(bcrypt.hash.called).to.be.true;\nexpect(adminDB.insertOne.calledWithExactly(adminDB.users, newUser)).to.be\n  .true;\nexpect(\n  adminDB.insertOne.calledWithExactly(adminDB.solved, {\n    handle: req.body.handle,\n    problems: [],\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;User Registered Successfully\&quot;,\n  })\n).to.be.true;\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d5c496d9-3f1e-4081-9417-ce5eeb5c80ba&quot;,&quot;parentUUID&quot;:&quot;03dc0587-dd20-4166-bd50-d29717e4b52e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user registration fails&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if user registration fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = \&quot;hashedPassword\&quot;;\nstub(bcrypt, \&quot;hash\&quot;).callsFake((_password, _len, callback) =&gt; {\n  callback(null, hashedPassword);\n});\nadminDB.findOne.resolves(null);\nadminDB.insertOne.throws(new Error(\&quot;Database error\&quot;));\nawait user.fillDetails(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(bcrypt.hash.called).to.be.true;\nexpect(\n  adminDB.insertOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n    password: hashedPassword,\n    name: req.body.name,\n    handle: req.body.handle,\n    type: \&quot;0\&quot;,\n    city: null,\n    birthdate: null,\n    address: null,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User Registration Failed\&quot;,\n  })\n).to.be.true;\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b333eab-6663-423c-ad4a-5d92c3eda13e&quot;,&quot;parentUUID&quot;:&quot;03dc0587-dd20-4166-bd50-d29717e4b52e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;64e242b3-dd49-4987-972e-2768e7661a15&quot;,&quot;e42d24b4-1453-45ab-b69d-9db1b5a9925e&quot;,&quot;7efc953a-3ccf-455a-a362-91a33a0561e8&quot;,&quot;d5c496d9-3f1e-4081-9417-ce5eeb5c80ba&quot;,&quot;4b333eab-6663-423c-ad4a-5d92c3eda13e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ad1c1f84-f149-4900-b6ef-952148474775&quot;,&quot;title&quot;:&quot;verifyOTP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;verifyOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP \&quot;before each\&quot; hook in \&quot;verifyOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: stub(),\n  deleteOne: stub(),\n  otp: \&quot;otp\&quot;,\n};\nreq = {\n  body: {\n    email: email,\n    otp: otp,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, {}, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;12e77a53-58ab-4220-a7f1-4d4ea3cb5402&quot;,&quot;parentUUID&quot;:&quot;ad1c1f84-f149-4900-b6ef-952148474775&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send success response if OTP matches&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP should send success response if OTP matches&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.resolves({\n  email: req.body.email,\n  otp: req.body.otp,\n});\nawait user.verifyOTP(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  adminDB.deleteOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;OTP Verified Successfully\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a53d8188-48f8-4351-bcf4-c62d04362c01&quot;,&quot;parentUUID&quot;:&quot;ad1c1f84-f149-4900-b6ef-952148474775&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if OTP does not match&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP should send error response if OTP does not match&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.resolves({\n  email: req.body.email,\n  otp: \&quot;wrongOTP\&quot;,\n});\nawait user.verifyOTP(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Invalid OTP\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;264e1542-6e28-42d3-8366-da8b6b2237f7&quot;,&quot;parentUUID&quot;:&quot;ad1c1f84-f149-4900-b6ef-952148474775&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if OTP verification fails&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP should send error response if OTP verification fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.throws(new Error(\&quot;Database error\&quot;));\nawait user.verifyOTP(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;OTP Verification Failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;27f5ae5c-3384-4ce6-8c03-06d1a3305603&quot;,&quot;parentUUID&quot;:&quot;ad1c1f84-f149-4900-b6ef-952148474775&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a53d8188-48f8-4351-bcf4-c62d04362c01&quot;,&quot;264e1542-6e28-42d3-8366-da8b6b2237f7&quot;,&quot;27f5ae5c-3384-4ce6-8c03-06d1a3305603&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6cf27e57-7d67-4fd3-a97d-ef53090af170&quot;,&quot;title&quot;:&quot;sendOTP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;User sendOTP \&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = { body: { email: email } };\nres = {\n  send: stub(),\n};\n// Mocking adminDB and adminMail objects\nadminDB = {\n  findOne: stub(),\n  updateOne: stub(),\n  insertOne: stub(),\n  users: \&quot;users\&quot;,\n  otp: \&quot;otp\&quot;,\n};\nadminMail = {\n  sendOTP: stub(),\n};\n// Importing the sendOTP function\nuser = new User(adminDB, {}, adminMail);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;289dde98-3ad1-4b38-b3c3-3e73e8519488&quot;,&quot;parentUUID&quot;:&quot;6cf27e57-7d67-4fd3-a97d-ef53090af170&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send OTP and respond with success message if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should send OTP and respond with success message if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to return null (user does not exist)\nadminDB.findOne.returns(null);\nconst mathRandomStub = stub(Math, \&quot;random\&quot;).returns(0.5);\nconst mathFloorStub = stub(Math, \&quot;floor\&quot;).returns(500000);\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(adminDB.findOne.callCount).to.equal(2);\nexpect(\n  adminDB.findOne.calledWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(mathRandomStub.calledOnce).to.be.true;\nexpect(mathFloorStub.calledOnce).to.be.true;\nexpect(adminMail.sendOTP.calledOnceWith(req.body.email, 500000)).to.be\n  .true;\nexpect(\n  adminDB.findOne.calledWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  adminDB.insertOne.calledOnceWith(adminDB.otp, {\n    email: req.body.email,\n    otp: 500000,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: true,\n    message: \&quot;OTP Sent Successfully\&quot;,\n  })\n).to.be.true;\nmathRandomStub.restore();\nmathFloorStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c36ffb05-52c9-4709-b420-201ec215221e&quot;,&quot;parentUUID&quot;:&quot;6cf27e57-7d67-4fd3-a97d-ef53090af170&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send OTP and respond with success message if otp exists in the otp collection&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should send OTP and respond with success message if otp exists in the otp collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to return null (user does not exist)\nadminDB.findOne.onCall(0).returns(null);\nadminDB.findOne.onCall(1).returns(true);\nconst mathRandomStub = stub(Math, \&quot;random\&quot;).returns(0.5);\nconst mathFloorStub = stub(Math, \&quot;floor\&quot;).returns(500000);\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(mathRandomStub.calledOnce).to.be.true;\nexpect(mathFloorStub.calledOnce).to.be.true;\nexpect(adminMail.sendOTP.calledOnceWith(req.body.email, 500000)).to.be\n  .true;\nexpect(\n  adminDB.updateOne.calledOnceWith(\n    adminDB.otp,\n    { email: email },\n    { $set: { otp: 500000 } }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: true,\n    message: \&quot;OTP Sent Successfully\&quot;,\n  })\n).to.be.true;\nmathRandomStub.restore();\nmathFloorStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7f52136d-6a36-4eb7-82dd-ec25f38180a6&quot;,&quot;parentUUID&quot;:&quot;6cf27e57-7d67-4fd3-a97d-ef53090af170&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user already exists&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should send error response if user already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to return a user (user already exists)\nadminDB.findOne.returns({ email: email });\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(adminMail.sendOTP.notCalled).to.be.true;\nexpect(adminDB.insertOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;User already exists\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e8828e9d-9f83-4e69-88ff-035aed1c3c06&quot;,&quot;parentUUID&quot;:&quot;6cf27e57-7d67-4fd3-a97d-ef53090af170&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors and respond with failure message&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should handle errors and respond with failure message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to throw an error\nadminDB.findOne.throws(new Error(\&quot;Database error\&quot;));\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(adminMail.sendOTP.notCalled).to.be.true;\nexpect(adminDB.insertOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;OTP generation failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;581d8b63-4e46-4a92-8009-1c15d9b554ed&quot;,&quot;parentUUID&quot;:&quot;6cf27e57-7d67-4fd3-a97d-ef53090af170&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c36ffb05-52c9-4709-b420-201ec215221e&quot;,&quot;7f52136d-6a36-4eb7-82dd-ec25f38180a6&quot;,&quot;e8828e9d-9f83-4e69-88ff-035aed1c3c06&quot;,&quot;581d8b63-4e46-4a92-8009-1c15d9b554ed&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ce3d9a44-acbf-4e62-ba99-09025e53c59d&quot;,&quot;title&quot;:&quot;changePassword&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;changePassword\&quot;&quot;,&quot;fullTitle&quot;:&quot;User changePassword \&quot;before each\&quot; hook in \&quot;changePassword\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req = { body: { email: email, newPassword: newpassword } };\nres = {\n  send: stub(),\n};\nadminDB = {\n  findOne: stub(),\n  updateOne: stub(),\n  users: \&quot;users\&quot;,\n};\nuser = new User(adminDB, {}, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;47501361-5809-4d10-90ba-98b10ebdb55c&quot;,&quot;parentUUID&quot;:&quot;ce3d9a44-acbf-4e62-ba99-09025e53c59d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should change password and respond with success message if user exists&quot;,&quot;fullTitle&quot;:&quot;User changePassword should change password and respond with success message if user exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.returns({ email: email });\nconst bcryptHashStub = stub(bcrypt, \&quot;hash\&quot;)\n  .callsArgWith(2, null, hash);\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(bcrypt.hash.calledOnceWith(req.body.newPassword, 10)).to.be.true;\nexpect(\n  adminDB.updateOne.calledOnceWith(\n    adminDB.users,\n    { email: req.body.email },\n    { $set: { password: hash } }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: true,\n    message: \&quot;Password Changed Successfully.\&quot;,\n  })\n).to.be.true;\nbcryptHashStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;70549ab1-3d77-4e5e-82d1-fb9798b2ae93&quot;,&quot;parentUUID&quot;:&quot;ce3d9a44-acbf-4e62-ba99-09025e53c59d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if bcrypt.hash encounters an error&quot;,&quot;fullTitle&quot;:&quot;User changePassword should send error response if bcrypt.hash encounters an error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.returns({ email: email });\nconst bcryptHashStub = stub(bcrypt, \&quot;hash\&quot;)\n  .callsArgWith(2, new Error(\&quot;Hashing error\&quot;));\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(bcrypt.hash.calledOnceWith(req.body.newPassword, 10)).to.be.true;\nexpect(adminDB.updateOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Password Updation Failed due to some internal error.\&quot;,\n  })\n).to.be.true;\nbcryptHashStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db0e64f5-0f23-4b37-89ae-9398ff2529ce&quot;,&quot;parentUUID&quot;:&quot;ce3d9a44-acbf-4e62-ba99-09025e53c59d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User changePassword should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.returns(null);\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(adminDB.updateOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;User does not exists.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;401056db-d9ab-4280-846a-eff71706ed7f&quot;,&quot;parentUUID&quot;:&quot;ce3d9a44-acbf-4e62-ba99-09025e53c59d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors and respond with failure message&quot;,&quot;fullTitle&quot;:&quot;User changePassword should handle errors and respond with failure message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.throws(new Error(\&quot;Database error\&quot;));\nconst bcryptHashStub = stub(bcrypt, \&quot;hash\&quot;)\n  .callsArgWith(2, new Error(\&quot;Hashing error\&quot;));\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(bcrypt.hash.notCalled).to.be.true;\nexpect(adminDB.updateOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Password Updation Failed due to some internal error.\&quot;,\n  })\n).to.be.true;\nbcryptHashStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;90a9b753-a65a-4108-8ccc-67557937fcce&quot;,&quot;parentUUID&quot;:&quot;ce3d9a44-acbf-4e62-ba99-09025e53c59d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;70549ab1-3d77-4e5e-82d1-fb9798b2ae93&quot;,&quot;db0e64f5-0f23-4b37-89ae-9398ff2529ce&quot;,&quot;401056db-d9ab-4280-846a-eff71706ed7f&quot;,&quot;90a9b753-a65a-4108-8ccc-67557937fcce&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c333e887-7ca3-411e-9551-c33375235eda&quot;,&quot;title&quot;:&quot;userLogout&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogout \&quot;before each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = { body: { userToken: &#x27;validToken&#x27; } };\nres = {\n  send: stub(),\n};\n  \n// Mocking adminJWT and adminDB objects\nadminJWT = {\n  verifyToken: stub(),\n};\n  \nadminDB = {\n  findOne: stub(),\n  users: &#x27;users&#x27;,\n};\n\n// Importing the userLogout function\nuser = new User(adminDB, adminJWT, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8bca4320-aec6-4aa1-88c8-3cb8fc6f1bae&quot;,&quot;parentUUID&quot;:&quot;c333e887-7ca3-411e-9551-c33375235eda&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogout \&quot;after each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions to their original implementation\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;04998ae8-86da-49ae-b32e-d3a3f0ed9f9b&quot;,&quot;parentUUID&quot;:&quot;c333e887-7ca3-411e-9551-c33375235eda&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send success response if user exists&quot;,&quot;fullTitle&quot;:&quot;User userLogout should send success response if user exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return email\nadminJWT.verifyToken.returns({ email: email });\n  \n// Stubbing adminDB.findOne to return user data\nadminDB.findOne.returns({ email: email });\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(adminDB.findOne.calledOnceWith(adminDB.users, { email: email })).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: true,\n  message: &#x27;User Logged Out Successfully&#x27;,\n  userToken: &#x27;&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ad4191da-d174-4c93-b73a-558a3119bf90&quot;,&quot;parentUUID&quot;:&quot;c333e887-7ca3-411e-9551-c33375235eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User userLogout should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return email\nadminJWT.verifyToken.returns({ email: email });\n  \n// Stubbing adminDB.findOne to return null (user does not exist)\nadminDB.findOne.returns(null);\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(adminDB.findOne.calledOnceWith(adminDB.users, { email: email })).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;User does not exists&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3fa3c820-3052-46b8-b24c-f84ea3289d2a&quot;,&quot;parentUUID&quot;:&quot;c333e887-7ca3-411e-9551-c33375235eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle TokenExpiredError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;User userLogout should handle TokenExpiredError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw TokenExpiredError\nadminJWT.verifyToken.throws(new TokenExpiredError(&#x27;Token expired&#x27;));\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;User has been logged out.&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1f25ee96-2c0e-41fe-8b32-e598688795ba&quot;,&quot;parentUUID&quot;:&quot;c333e887-7ca3-411e-9551-c33375235eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle JsonWebTokenError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;User userLogout should handle JsonWebTokenError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw JsonWebTokenError\nadminJWT.verifyToken.throws(new JsonWebTokenError(&#x27;Invalid token&#x27;));\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: \&quot;User has logged out.Kindly login again\&quot;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;27be2276-0dbf-4cdd-8d23-752818ddebe7&quot;,&quot;parentUUID&quot;:&quot;c333e887-7ca3-411e-9551-c33375235eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;User userLogout should handle other errors and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(&#x27;Some error&#x27;));\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Some error&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7da89aca-9d33-418e-a771-4cf6a47842de&quot;,&quot;parentUUID&quot;:&quot;c333e887-7ca3-411e-9551-c33375235eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ad4191da-d174-4c93-b73a-558a3119bf90&quot;,&quot;3fa3c820-3052-46b8-b24c-f84ea3289d2a&quot;,&quot;1f25ee96-2c0e-41fe-8b32-e598688795ba&quot;,&quot;27be2276-0dbf-4cdd-8d23-752818ddebe7&quot;,&quot;7da89aca-9d33-418e-a771-4cf6a47842de&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4eac8297-19c1-4756-9b63-513536ed1c51&quot;,&quot;title&quot;:&quot;getAllHandles&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles \&quot;before each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {};\nres = {\n  send: stub(),\n};\n  \n// Mocking adminDB object\nadminDB = {\n  find: stub(),\n  users: &#x27;users&#x27;,\n};\n  \nuser = new User(adminDB, {}, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0124366d-d91d-49d1-a3bf-d5fe31c66b7c&quot;,&quot;parentUUID&quot;:&quot;4eac8297-19c1-4756-9b63-513536ed1c51&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles \&quot;after each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions to their original implementation\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f215d0ce-6fd9-4550-b9d0-28a9ddebd8fd&quot;,&quot;parentUUID&quot;:&quot;4eac8297-19c1-4756-9b63-513536ed1c51&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should fetch all handles and send success response&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles should fetch all handles and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.find to return user data\nconst users = [\n  { handle: &#x27;handle1&#x27; },\n  { handle: &#x27;handle2&#x27; },\n  { handle: &#x27;handle3&#x27; },\n];\nadminDB.find.returns(users);\n  \n// Calling the getAllHandles function\nawait user.getAllHandles(req, res);\n  \n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.users, {})).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: true,\n  message: &#x27;All Handles&#x27;,\n  handles: [&#x27;handle1&#x27;, &#x27;handle2&#x27;, &#x27;handle3&#x27;],\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b9af7fa6-c374-4837-bbfc-745c55f31fbf&quot;,&quot;parentUUID&quot;:&quot;4eac8297-19c1-4756-9b63-513536ed1c51&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors and send error response&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles should handle errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.find to throw an error\nadminDB.find.throws(new Error(&#x27;Database error&#x27;));\n  \n// Calling the getAllHandles function\nawait user.getAllHandles(req, res);\n  \n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.users, {})).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Error in fetching handles&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e6071b31-1fe5-48e6-a858-c62e69bd9294&quot;,&quot;parentUUID&quot;:&quot;4eac8297-19c1-4756-9b63-513536ed1c51&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b9af7fa6-c374-4837-bbfc-745c55f31fbf&quot;,&quot;e6071b31-1fe5-48e6-a858-c62e69bd9294&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.2.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;custom-report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportFilename&quot;:&quot;custom-report&quot;,&quot;reportDir&quot;:&quot;reports&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;custom-report&quot;,&quot;reportDir&quot;:&quot;reports&quot;,&quot;reportTitle&quot;:&quot;server&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;reports/assets&quot;,&quot;jsonFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/reports/custom-report.json&quot;,&quot;htmlFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/reports/custom-report.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>