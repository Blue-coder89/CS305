<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:28,&quot;tests&quot;:62,&quot;passes&quot;:62,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2023-05-04T13:37:15.255Z&quot;,&quot;end&quot;:&quot;2023-05-04T13:37:29.161Z&quot;,&quot;duration&quot;:13906,&quot;testsRegistered&quot;:62,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;6a727fa0-c160-49a3-87b2-72f607162e2a&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;125a9ace-77a4-431e-8556-327797baf7a2&quot;,&quot;title&quot;:&quot;Blog&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4db04f66-7cda-472c-b1a2-4fc759c08710&quot;,&quot;title&quot;:&quot;postBlog&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog \&quot;before each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {\n  body: {\n    userToken: \&quot;validToken\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\n// Mocking adminJWT, adminDB, and blog objects\nadminJWT = {\n  verifyToken: stub(),\n};\nadminDB = {\n  insertOne: stub(),\n  blog: {},\n};\ntestBlog = new Blog(adminDB, adminJWT);\n// Importing the postBlog function&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1c2afa9-a03d-419b-83f3-ba2b0e704515&quot;,&quot;parentUUID&quot;:&quot;4db04f66-7cda-472c-b1a2-4fc759c08710&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog \&quot;after each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f955dda8-08ae-445e-a5e8-093f61721717&quot;,&quot;parentUUID&quot;:&quot;4db04f66-7cda-472c-b1a2-4fc759c08710&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post a blog and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog should post a blog and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return handle and type\nadminJWT.verifyToken.returns({ handle: handle, type: type });\n// Stubbing adminDB.insertOne to return data\nadminDB.insertOne.returns({});\n// Calling the postBlog function\nawait testBlog.postBlog(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  adminDB.insertOne.calledOnceWith(adminDB.blog, match.instanceOf(blog))\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({ success: true, message: \&quot;Blog posted.\&quot; })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f9ca7143-6be3-4ff7-be9e-92b5e0c3c266&quot;,&quot;parentUUID&quot;:&quot;4db04f66-7cda-472c-b1a2-4fc759c08710&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle TokenExpiredError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog should handle TokenExpiredError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw TokenExpiredError\nadminJWT.verifyToken.throws(new TokenExpiredError(\&quot;Token expired\&quot;));\n// Calling the postBlog function\nawait testBlog.postBlog(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;303d25d9-0734-476a-861e-246708084471&quot;,&quot;parentUUID&quot;:&quot;4db04f66-7cda-472c-b1a2-4fc759c08710&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog should handle other errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(\&quot;Some error\&quot;));\n// Calling the postBlog function\nawait testBlog.postBlog(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Blog posting failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;54a033e7-d8e4-4d20-b539-128e39d68976&quot;,&quot;parentUUID&quot;:&quot;4db04f66-7cda-472c-b1a2-4fc759c08710&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f9ca7143-6be3-4ff7-be9e-92b5e0c3c266&quot;,&quot;303d25d9-0734-476a-861e-246708084471&quot;,&quot;54a033e7-d8e4-4d20-b539-128e39d68976&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;64287a29-7889-4307-8b30-8909fa78e1ce&quot;,&quot;title&quot;:&quot;postEditorial&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial \&quot;before each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {\n  body: {\n    userToken: \&quot;validToken\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\n// Mocking adminJWT, adminDB, and editorial objects\nadminJWT = {\n  verifyToken: stub(),\n};\nadminDB = {\n  insertOne: stub(),\n  editorials: \&quot;editorials\&quot;,\n};\ntestEditorial = new Blog(adminDB, adminJWT);\n// Importing the postEditorial function&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d2b65879-8e15-45c7-9ca4-367113ea9d89&quot;,&quot;parentUUID&quot;:&quot;64287a29-7889-4307-8b30-8909fa78e1ce&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial \&quot;after each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;247c2ae1-1258-4978-a137-e36c2b858a99&quot;,&quot;parentUUID&quot;:&quot;64287a29-7889-4307-8b30-8909fa78e1ce&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post an editorial and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should post an editorial and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return handle and type\nadminJWT.verifyToken.returns({ handle: handle, type: \&quot;1\&quot; });\n// Stubbing adminDB.insertOne to return data\nadminDB.insertOne.returns({});\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  adminDB.insertOne.calledOnceWith(\n    adminDB.editorials,\n    match.instanceOf(editorial)\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({ success: true, message: \&quot;Editorial posted.\&quot; })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d19f8977-6b8c-4f3c-b028-373e6c8af502&quot;,&quot;parentUUID&quot;:&quot;64287a29-7889-4307-8b30-8909fa78e1ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not post an editorial and send unauthorized response for type 0&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should not post an editorial and send unauthorized response for type 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return handle and type\nadminJWT.verifyToken.returns({ handle: handle, type: \&quot;0\&quot; });\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;You are not authorized to post editorials.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c60a22cc-a82c-4bc0-803b-b17ed85d7c98&quot;,&quot;parentUUID&quot;:&quot;64287a29-7889-4307-8b30-8909fa78e1ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle TokenExpiredError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should handle TokenExpiredError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw TokenExpiredError\nadminJWT.verifyToken.throws(new TokenExpiredError(\&quot;Token expired\&quot;));\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ace2c53c-d5ae-4a94-9c4b-388920db855b&quot;,&quot;parentUUID&quot;:&quot;64287a29-7889-4307-8b30-8909fa78e1ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should handle other errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(\&quot;Some error\&quot;));\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Editorial posting failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6758f066-3c39-4fae-ac7f-503c1f663ca0&quot;,&quot;parentUUID&quot;:&quot;64287a29-7889-4307-8b30-8909fa78e1ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should handle other errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(\&quot;Some error\&quot;));\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Editorial posting failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;59fe2e35-115d-4f57-9277-60bd9583ecd0&quot;,&quot;parentUUID&quot;:&quot;64287a29-7889-4307-8b30-8909fa78e1ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d19f8977-6b8c-4f3c-b028-373e6c8af502&quot;,&quot;c60a22cc-a82c-4bc0-803b-b17ed85d7c98&quot;,&quot;ace2c53c-d5ae-4a94-9c4b-388920db855b&quot;,&quot;6758f066-3c39-4fae-ac7f-503c1f663ca0&quot;,&quot;59fe2e35-115d-4f57-9277-60bd9583ecd0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1bdf311c-f924-44c5-bb68-0291f2bcf841&quot;,&quot;title&quot;:&quot;getBlogComments&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getBlogComments\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogComments \&quot;before each\&quot; hook in \&quot;getBlogComments\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {\n  body: {\n    blogId: \&quot;validBlogId1\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\n// Mocking adminDB object\nadminDB = {\n  findOne: stub(),\n  blog: \&quot;blog\&quot;,\n};\n// Importing the getBlogComments function\ntestBlog = new Blog(adminDB, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;798bdeb2-91cc-4084-b13a-acbcff79bee7&quot;,&quot;parentUUID&quot;:&quot;1bdf311c-f924-44c5-bb68-0291f2bcf841&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get blog comments and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogComments should get blog comments and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedComments = [\&quot;comment1\&quot;, \&quot;comment2\&quot;];\n// Stubbing adminDB.findOne to return data with comments\nadminDB.findOne.returns({ comments: expectedComments });\n// Calling the getBlogComments function\nawait testBlog.getBlogComments(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(\n    adminDB.blog,\n    { _id: new ObjectId(\&quot;validBlogId1\&quot;) },\n    { comments: 1, _id: 0 }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    data: expectedComments,\n    success: true,\n    message: \&quot;Comments sent successfully.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;917fee09-c4cf-4b53-8f72-f41037b03266&quot;,&quot;parentUUID&quot;:&quot;1bdf311c-f924-44c5-bb68-0291f2bcf841&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle error and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogComments should handle error and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to throw an error\nadminDB.findOne.throws(new Error(\&quot;Some error\&quot;));\n// Calling the getBlogComments function\nawait testBlog.getBlogComments(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(\n    adminDB.blog,\n    { _id: new ObjectId(\&quot;validBlogId1\&quot;) },\n    { comments: 1, _id: 0 }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Comments could not be sent due to some internal error.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8c04dab9-b9b1-4741-8269-cbe10f009cf5&quot;,&quot;parentUUID&quot;:&quot;1bdf311c-f924-44c5-bb68-0291f2bcf841&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;917fee09-c4cf-4b53-8f72-f41037b03266&quot;,&quot;8c04dab9-b9b1-4741-8269-cbe10f009cf5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;da33e5b6-cbe8-4fed-9c95-4fd6733c7b12&quot;,&quot;title&quot;:&quot;getBlogs&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getBlogs\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogs \&quot;before each\&quot; hook in \&quot;getBlogs\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking res object\nres = {\n  send: stub(),\n};\n// Mocking adminDB object\nadminDB = {\n  find:stub(),\n  blog: &#x27;blog&#x27;,\n};\n// Importing the getBlogs function\ntestBlog = new Blog(adminDB, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ba5038a-13bd-4f93-a6f5-86ccfaa6a320&quot;,&quot;parentUUID&quot;:&quot;da33e5b6-cbe8-4fed-9c95-4fd6733c7b12&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get blogs and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogs should get blogs and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedBlogs = [&#x27;blog1&#x27;, &#x27;blog2&#x27;];\n// Stubbing adminDB.find to return data with blogs\nadminDB.find.returns(expectedBlogs);\n// Calling the getBlogs function\nawait testBlog.getBlogs({}, res);\n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.blog, {}, { timestamp: -1 }, { comments: 0 })).to.be.true;\nexpect(res.send.calledOnceWith({ data: expectedBlogs, success: true, message: &#x27;Blogs sent successfully.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3a816a3b-783f-4c7c-9971-06da42e792fc&quot;,&quot;parentUUID&quot;:&quot;da33e5b6-cbe8-4fed-9c95-4fd6733c7b12&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle error and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogs should handle error and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.find to throw an error\nadminDB.find.throws(new Error(&#x27;Some error&#x27;));\n// Calling the getBlogs function\nawait testBlog.getBlogs({}, res);\n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.blog, {}, { timestamp: -1 }, { comments: 0 })).to.be.true;\nexpect(res.send.calledOnceWith({ success: false, message: &#x27;Blogs could not be sent due to some internal error.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d51d4dd4-1f85-422e-bd2a-5dd71b87d02f&quot;,&quot;parentUUID&quot;:&quot;da33e5b6-cbe8-4fed-9c95-4fd6733c7b12&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3a816a3b-783f-4c7c-9971-06da42e792fc&quot;,&quot;d51d4dd4-1f85-422e-bd2a-5dd71b87d02f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;461a3cb9-cbe4-41fe-9184-c32e2d422c63&quot;,&quot;title&quot;:&quot;database&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;37d53291-c0b3-4836-bc00-738e706d534e&quot;,&quot;title&quot;:&quot;connect&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;fullTitle&quot;:&quot;database connect \&quot;before each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();  \ntestDatabase = new database(uri,databaseName);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fa0ee861-6612-4b84-b236-44e22b04bd72&quot;,&quot;parentUUID&quot;:&quot;37d53291-c0b3-4836-bc00-738e706d534e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;fullTitle&quot;:&quot;database connect \&quot;after each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8a59e059-f71b-4b4e-afd2-6827a57df3e3&quot;,&quot;parentUUID&quot;:&quot;37d53291-c0b3-4836-bc00-738e706d534e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should connect to the database&quot;,&quot;fullTitle&quot;:&quot;database connect should connect to the database&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const consoleSpy = spy(console,\&quot;log\&quot;);\nconst dbMock = {collection : stub()} // mock database collection\nconst clientMock = {\n    connect : stub().resolves() //returns a resolved promise (Which stimulates the condition when database is connected)\n, db : stub().returns(dbMock)}; //returns a mock database\ntestDatabase.client = clientMock;\nawait testDatabase.connect();\nexpect(clientMock.connect.calledOnce).to.be.true;\nexpect(consoleSpy.calledOnce).to.be.true;\nexpect(consoleSpy.firstCall.args[0]).to.equal(\&quot;DB Connection successful\&quot;);\nexpect(clientMock.db.calledWith(databaseName)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Users\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;otp\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Problems\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Blogs\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Editorials\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;SubmittedSolutions\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Solved\&quot;)).to.be.true;\nconsoleSpy.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e5dfd421-b49a-4ff1-8d45-5cb970df4036&quot;,&quot;parentUUID&quot;:&quot;37d53291-c0b3-4836-bc00-738e706d534e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e5dfd421-b49a-4ff1-8d45-5cb970df4036&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;322fe6f4-61a8-4fde-81fb-a4caa680c951&quot;,&quot;title&quot;:&quot;findOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database findOne \&quot;before each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a2fb83d-54a4-4087-ad0c-100c32da1efd&quot;,&quot;parentUUID&quot;:&quot;322fe6f4-61a8-4fde-81fb-a4caa680c951&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database findOne \&quot;after each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3b0c1f96-d702-4340-833a-6e3579b26507&quot;,&quot;parentUUID&quot;:&quot;322fe6f4-61a8-4fde-81fb-a4caa680c951&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return a document&quot;,&quot;fullTitle&quot;:&quot;database findOne should return a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21 };\nawait testDatabase.users.insertOne(doc);\n      \n// Call the findOne function with the query object\nconst query = { name: &#x27;user&#x27; };\nconst fields = { age:21, _id:0 };\nconst result = await testDatabase.findOne(testDatabase.users, query, fields);\n      \n// Assert that the result matches the expected document\nexpect (result).to.be.an(&#x27;object&#x27;);\n  expect (result).to.deep.equal({ age:21 });&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d32af6b8-5ee1-42a1-af0f-9d697e851888&quot;,&quot;parentUUID&quot;:&quot;322fe6f4-61a8-4fde-81fb-a4caa680c951&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d32af6b8-5ee1-42a1-af0f-9d697e851888&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d91c647f-e435-458c-bec7-1a99de8d264a&quot;,&quot;title&quot;:&quot;insertOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database insertOne \&quot;before each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ec940042-ddce-47f5-875d-5d7839d6882e&quot;,&quot;parentUUID&quot;:&quot;d91c647f-e435-458c-bec7-1a99de8d264a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database insertOne \&quot;after each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fe56fa2d-7908-4f6b-bf19-779786a9e8a0&quot;,&quot;parentUUID&quot;:&quot;d91c647f-e435-458c-bec7-1a99de8d264a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should insert a document&quot;,&quot;fullTitle&quot;:&quot;database insertOne should insert a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21 };\nlet insertData = await testDatabase.insertOne(testDatabase.users,doc);\n  // Assert that the result matches the expected document\nexpect (insertData.acknowledged).to.equal(true);\nexpect (insertData.insertedId).to.not.equal(null | undefined);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c3200703-2e6f-456c-872c-1ebd22a7ea23&quot;,&quot;parentUUID&quot;:&quot;d91c647f-e435-458c-bec7-1a99de8d264a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c3200703-2e6f-456c-872c-1ebd22a7ea23&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8b728729-7728-40e7-8c2a-39eb9b5486d9&quot;,&quot;title&quot;:&quot;updateOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database updateOne \&quot;before each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cd5cb7a7-2841-4943-bffa-b037062a9e53&quot;,&quot;parentUUID&quot;:&quot;8b728729-7728-40e7-8c2a-39eb9b5486d9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database updateOne \&quot;after each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2e7100be-ec69-4c0d-b27a-4ee66ae9a160&quot;,&quot;parentUUID&quot;:&quot;8b728729-7728-40e7-8c2a-39eb9b5486d9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return a document&quot;,&quot;fullTitle&quot;:&quot;database updateOne should return a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21,hobby : []};\nawait testDatabase.users.insertOne(doc);\n    \n// Call the findOne function with the query object\nlet query = { name: &#x27;user&#x27; };\nlet result = await testDatabase.updateOne(testDatabase.users, query, {$set : {name: \&quot;newUser\&quot;}});\nexpect(result).to.be.an(&#x27;object&#x27;);\nexpect(result.acknowledged).to.equal(true);\nexpect(result.modifiedCount).to.equal(1);\nquery = { name: &#x27;newUser&#x27; };\nresult = await testDatabase.updateOne(testDatabase.users, query, {$push : {hobby: \&quot;newUser\&quot;}});\nexpect(result).to.be.an(&#x27;object&#x27;);\nexpect(result.acknowledged).to.equal(true);\nexpect(result.modifiedCount).to.equal(1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb22ce0a-3ee6-4981-a4f7-70504bf790cd&quot;,&quot;parentUUID&quot;:&quot;8b728729-7728-40e7-8c2a-39eb9b5486d9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bb22ce0a-3ee6-4981-a4f7-70504bf790cd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0c17c28f-ab88-4cc1-8790-cfd14d6ca728&quot;,&quot;title&quot;:&quot;deleteOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database deleteOne \&quot;before each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1cff506d-4430-45f8-9ec1-1c0447c8e336&quot;,&quot;parentUUID&quot;:&quot;0c17c28f-ab88-4cc1-8790-cfd14d6ca728&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database deleteOne \&quot;after each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c5183fea-ee88-4e90-b2d1-cada6ee09850&quot;,&quot;parentUUID&quot;:&quot;0c17c28f-ab88-4cc1-8790-cfd14d6ca728&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should delete a document&quot;,&quot;fullTitle&quot;:&quot;database deleteOne should delete a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21};\nawait testDatabase.users.insertOne(doc);\n    \n// Call the findOne function with the query object\nlet query = { name: &#x27;user&#x27; };\nlet result = await testDatabase.deleteOne(testDatabase.users, query);\nexpect(result).to.be.an(&#x27;object&#x27;);\nexpect(result.acknowledged).to.equal(true);\nexpect(result.deletedCount).to.equal(1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9e669488-44fe-44c2-a909-0bbce01330e7&quot;,&quot;parentUUID&quot;:&quot;0c17c28f-ab88-4cc1-8790-cfd14d6ca728&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9e669488-44fe-44c2-a909-0bbce01330e7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c72d649a-85ed-4c08-a2bd-a98de28d7eda&quot;,&quot;title&quot;:&quot;find&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;find\&quot;&quot;,&quot;fullTitle&quot;:&quot;database find \&quot;before all\&quot; hook in \&quot;find\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create a test collection and insert some documents\nmongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.client.connect();\ntestDatabase.users = testDatabase.client.db(testDatabase.database).collection(&#x27;users&#x27;);\nawait testDatabase.users.insertMany([\n  { name: &#x27;user1&#x27;, age: 21 },\n  { name: &#x27;user2&#x27;, age: 22 },\n  { name: &#x27;user3&#x27;, age: 23 },\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8a45d53e-8b31-4728-933e-072bb3b094ba&quot;,&quot;parentUUID&quot;:&quot;c72d649a-85ed-4c08-a2bd-a98de28d7eda&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;find\&quot;&quot;,&quot;fullTitle&quot;:&quot;database find \&quot;after all\&quot; hook in \&quot;find\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.client.close();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f097d057-a4d9-4925-8e46-521656204a4a&quot;,&quot;parentUUID&quot;:&quot;c72d649a-85ed-4c08-a2bd-a98de28d7eda&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should find all documents in the collection&quot;,&quot;fullTitle&quot;:&quot;database find should find all documents in the collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users);\nexpect(docs).to.have.lengthOf(3);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9701c001-7bb6-4a57-a70c-8f375327114f&quot;,&quot;parentUUID&quot;:&quot;c72d649a-85ed-4c08-a2bd-a98de28d7eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should find documents with a query object&quot;,&quot;fullTitle&quot;:&quot;database find should find documents with a query object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users, { name: &#x27;user1&#x27; });\nexpect(docs).to.have.lengthOf(1);\nexpect(docs[0].name).to.equal(&#x27;user1&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1621b871-2684-41ea-9d72-189cc64e1eb1&quot;,&quot;parentUUID&quot;:&quot;c72d649a-85ed-4c08-a2bd-a98de28d7eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should sort documents with a sort object&quot;,&quot;fullTitle&quot;:&quot;database find should sort documents with a sort object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users, {}, { age: -1 });\nexpect(docs).to.have.lengthOf(3);\nexpect(docs[0].name).to.equal(&#x27;user3&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7da6dc35-1a95-489a-ba61-9b98e2c893f7&quot;,&quot;parentUUID&quot;:&quot;c72d649a-85ed-4c08-a2bd-a98de28d7eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should project documents with a fields object&quot;,&quot;fullTitle&quot;:&quot;database find should project documents with a fields object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users, {}, {}, { name: 1 });\nexpect(docs).to.have.lengthOf(3);\nexpect(docs[0].name).to.exist;\nexpect(docs[0].age).to.not.exist;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;20115bf5-e044-4b32-bc56-5302b745a0e7&quot;,&quot;parentUUID&quot;:&quot;c72d649a-85ed-4c08-a2bd-a98de28d7eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9701c001-7bb6-4a57-a70c-8f375327114f&quot;,&quot;1621b871-2684-41ea-9d72-189cc64e1eb1&quot;,&quot;7da6dc35-1a95-489a-ba61-9b98e2c893f7&quot;,&quot;20115bf5-e044-4b32-bc56-5302b745a0e7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d66ec583-6e53-4de3-8f27-0299ba4fbb9e&quot;,&quot;title&quot;:&quot;update&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;update\&quot;&quot;,&quot;fullTitle&quot;:&quot;database update \&quot;before all\&quot; hook in \&quot;update\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create a test collection and insert some documents\nmongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.client.connect();\ntestDatabase.users = testDatabase.client.db(testDatabase.database).collection(&#x27;users&#x27;);\nawait testDatabase.users.insertMany([\n  { name: &#x27;user1&#x27;, age: 21,hobby:[] },\n  { name: &#x27;user2&#x27;, age: 22 ,hobby:[]},\n  { name: &#x27;user3&#x27;, age: 23 ,hobby:[]},\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bc7e654e-7480-4ef8-a3e4-c5357f27b99c&quot;,&quot;parentUUID&quot;:&quot;d66ec583-6e53-4de3-8f27-0299ba4fbb9e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;update\&quot;&quot;,&quot;fullTitle&quot;:&quot;database update \&quot;after all\&quot; hook in \&quot;update\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.client.close();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cb01fb84-8bc4-495c-bf25-56d607156339&quot;,&quot;parentUUID&quot;:&quot;d66ec583-6e53-4de3-8f27-0299ba4fbb9e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should set some values to all the documents with the required filter&quot;,&quot;fullTitle&quot;:&quot;database update should set some values to all the documents with the required filter&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.update(testDatabase.users, {  }, { $set: { age:50 } });\nexpect(docs.modifiedCount).to.equal(3);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;99e9b200-86ec-47cc-87c9-92754c3eeed2&quot;,&quot;parentUUID&quot;:&quot;d66ec583-6e53-4de3-8f27-0299ba4fbb9e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should push values in ana array to all the documents with the required filter&quot;,&quot;fullTitle&quot;:&quot;database update should push values in ana array to all the documents with the required filter&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.update(testDatabase.users, { age: {$gt:21} }, { $push: { hobby:\&quot;newHobby\&quot; } });\nexpect(docs.modifiedCount).to.equal(3);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fe21edaa-ab55-4cfa-b8e9-b527fbc105b8&quot;,&quot;parentUUID&quot;:&quot;d66ec583-6e53-4de3-8f27-0299ba4fbb9e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;99e9b200-86ec-47cc-87c9-92754c3eeed2&quot;,&quot;fe21edaa-ab55-4cfa-b8e9-b527fbc105b8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b4de0114-4fc6-4076-9f07-84c5cd41c12f&quot;,&quot;title&quot;:&quot;Email&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/email.test.js&quot;,&quot;file&quot;:&quot;/test/email.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f67333a0-e979-4538-a37f-1130e85f196a&quot;,&quot;title&quot;:&quot;sendMail&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/email.test.js&quot;,&quot;file&quot;:&quot;/test/email.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendMail \&quot;before each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;transporter = nodemailer.createTransport(nodemailerMock());\nemail = new Email();\nemail.transporter = transporter;\nemail.sender = \&quot;test92.test@gmail.com\&quot;;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6472b94e-c1ba-4d97-9610-46fbfaf63024&quot;,&quot;parentUUID&quot;:&quot;f67333a0-e979-4538-a37f-1130e85f196a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendMail \&quot;after each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8bda8038-c57b-4d46-843c-031e3c5c8068&quot;,&quot;parentUUID&quot;:&quot;f67333a0-e979-4538-a37f-1130e85f196a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send an email&quot;,&quot;fullTitle&quot;:&quot;Email sendMail should send an email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// to track the sendMail function of the email.transporter\nconst sendMailSpy = sinon.spy(email.transporter, \&quot;sendMail\&quot;);\nconst receiver = \&quot;nish95.sha@gmail.com\&quot;;\nconst subject = \&quot;Test Email\&quot;;\nconst text = \&quot;This is a test email.\&quot;;\n// call the sendMail function of the email class\nemail.sendMail(receiver, subject, text);\nexpect(sendMailSpy.calledOnce).to.be.true;\nexpect(sendMailSpy.firstCall.args[0]).to.deep.equal({\n  from: email.sender,\n  to: receiver,\n  subject: subject,\n  text: text,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5605b43f-55b2-410e-a582-c6a9b0fbcf94&quot;,&quot;parentUUID&quot;:&quot;f67333a0-e979-4538-a37f-1130e85f196a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should throw the error if the email fails to send&quot;,&quot;fullTitle&quot;:&quot;Email sendMail should throw the error if the email fails to send&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// mock the sendMail function of the email.transporter\nemail.transporter.sendMail = sinon\n  .stub()\n  .yields(\&quot;Failed to send email.\&quot;);\n  // to call the callback function of the sendMail function with the error message\nconst receiver = \&quot;recipient@example.com\&quot;;\nconst subject = \&quot;Test email\&quot;;\nconst text = \&quot;This is a test email.\&quot;;\nconst errorMessage = \&quot;Failed to send email.\&quot;;\nexpect(() =&gt; {\n  email.sendMail(receiver, subject, text);\n}).to.throw(Error, errorMessage);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;117995b2-a217-4e01-a29c-15421ae0c4fd&quot;,&quot;parentUUID&quot;:&quot;f67333a0-e979-4538-a37f-1130e85f196a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5605b43f-55b2-410e-a582-c6a9b0fbcf94&quot;,&quot;117995b2-a217-4e01-a29c-15421ae0c4fd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;267369e4-39d4-4dc9-a5f6-8396828acaa1&quot;,&quot;title&quot;:&quot;sendOTP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/email.test.js&quot;,&quot;file&quot;:&quot;/test/email.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendOTP \&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;transporter = nodemailer.createTransport(nodemailerMock());\nemail = new Email();\nemail.transporter = transporter;\nemail.sender = \&quot;test92.test@gmail.com\&quot;;\nemail.sendMail = sinon.stub().resolves();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a7d3a913-a186-48c0-b2c9-53b94130ab07&quot;,&quot;parentUUID&quot;:&quot;267369e4-39d4-4dc9-a5f6-8396828acaa1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendOTP \&quot;after each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e8ce2706-f7ac-41d1-aeba-30b3234cb1dd&quot;,&quot;parentUUID&quot;:&quot;267369e4-39d4-4dc9-a5f6-8396828acaa1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send an OTP&quot;,&quot;fullTitle&quot;:&quot;Email sendOTP should send an OTP&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const receiver = \&quot;nish95.sha@gmail.com\&quot;;\nconst otp = \&quot;123456\&quot;;\nemail.sendOTP(receiver, otp);\nexpect(\n  email.sendMail.calledOnceWithExactly(\n    receiver,\n    \&quot;OTP\&quot;,\n    `Your OTP is ${otp}`\n  )\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7621a359-a873-4e67-aa64-e6559f1a2115&quot;,&quot;parentUUID&quot;:&quot;267369e4-39d4-4dc9-a5f6-8396828acaa1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7621a359-a873-4e67-aa64-e6559f1a2115&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4f83f62c-b2cb-4ed6-b389-530fc275e914&quot;,&quot;title&quot;:&quot;Problems&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e9b63ce1-0082-44e8-a023-b0150a8422f1&quot;,&quot;title&quot;:&quot;handleCPP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;handleCPP\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems handleCPP \&quot;before each\&quot; hook in \&quot;handleCPP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;res = {\n  send: sinon.stub(),\n};\nadminDB = {\n  findOne: sinon.stub(),\n  insertOne: sinon.stub(),\n  updateOne: sinon.stub(),\n};\ntestProblem = new Problem(adminDB,{});\nproblemId = \&quot;644bc03d00e76ef0f3d3137f\&quot;;\ncode =\n`int sum(int a, int b) {return a+b;}`;\nlanguage = \&quot;C++\&quot;;\nhandle = \&quot;testHandle\&quot;;\ntimestamp = \&quot;timastamp\&quot;;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8e103af0-f44a-49ba-9e9a-679075c96e35&quot;,&quot;parentUUID&quot;:&quot;e9b63ce1-0082-44e8-a023-b0150a8422f1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return accept for correct solution&quot;,&quot;fullTitle&quot;:&quot;Problems handleCPP should return accept for correct solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13003,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(0);\nsetTimeout(done,13000)\n  adminDB.findOne.onFirstCall().returns({\n_id: new ObjectId(\&quot;644bc03d00e76ef0f3d3137f\&quot;),\nauthor_handle: &#x27;nishant_89&#x27;,\ntitle: &#x27;Add numbers in an array&#x27;,\ncontent: &#x27;Add numbers in an array&#x27;,\ncorrect_code_CPP: &#x27;#include &lt;bits/stdc++.h&gt;\\n&#x27; +\n  &#x27;using namespace std;\\n&#x27; +\n  &#x27;int sum(int a,int b){\\n&#x27; +\n  &#x27;    return a+b;\\n&#x27; +\n  &#x27;}\\n&#x27; +\n  &#x27;int main(){\\n&#x27; +\n  &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n  &#x27;\\tfreopen(\&quot;coutput.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n  &#x27;\\n&#x27; +\n  &#x27;    int t;\\n&#x27; +\n  &#x27;cin&gt;&gt;t;\\n&#x27; +\n  &#x27;while(t--){\\n&#x27; +\n  &#x27;\\t int a,b;\\n&#x27; +\n  &#x27;    cin&gt;&gt;a&gt;&gt;b;\\n&#x27; +\n  &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n  &#x27;}\\n&#x27; +\n  &#x27;   \\n&#x27; +\n  &#x27;    return 0;\\n&#x27; +\n  &#x27;}&#x27;,\ncorrect_code_JAVA: &#x27;import java.io.*;\\n&#x27; +\n  &#x27;\\n&#x27; +\n  &#x27;public class CorrectCode {\\n&#x27; +\n  &#x27;    public static void main(String[] args) {\\n&#x27; +\n  &#x27;        try {\\n&#x27; +\n  &#x27;            // Open input and output files\\n&#x27; +\n  &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n  &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;coutput.txt\&quot;));\\n&#x27; +\n  &#x27;\\n&#x27; +\n  &#x27;\\t\\t// Read first number from input file\\n&#x27; +\n  &#x27;            String line = reader.readLine();\\n&#x27; +\n  &#x27;            int t = Integer.parseInt(line);\\n&#x27; +\n  &#x27;\\n&#x27; +\n  &#x27;\\t\\twhile(t&gt;0){\\n&#x27; +\n  &#x27;\\t\\t\\tString input = reader.readLine();\\n&#x27; +\n  &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n  &#x27;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n&#x27; +\n  &#x27;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;            \\twriter.write(num1+num2+\&quot;\\\\n\&quot;);\\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;            \\t// Close input and output files\\n&#x27; +\n  &#x27;\\t\\t\\tt--;\\n&#x27; +\n  &#x27;\\t\\t}\\n&#x27; +\n  &#x27;\\t\\treader.close();\\n&#x27; +\n  &#x27;            writer.close();\\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;        } catch (IOException e) {\\n&#x27; +\n  &#x27;            e.printStackTrace();\\n&#x27; +\n  &#x27;        }\\n&#x27; +\n  &#x27;    }\\n&#x27; +\n  &#x27;}&#x27;,\ntime_limit: 1,\ninput_format: &#x27;input&#x27;,\noutput_format: &#x27;output&#x27;,\nexample_input: &#x27;sample_input&#x27;,\nexample_output: &#x27;sample_output&#x27;,\nfunction_def_CPP: &#x27;int sum(int a,int b){\\n}&#x27;,\ninput_template_CPP: &#x27;#include &lt;bits/stdc++.h&gt;\\n&#x27; +\n  &#x27;using namespace std;\\n&#x27; +\n  &#x27;#include \&quot;funcDef.h\&quot;\\n&#x27; +\n  &#x27;int main(){\\n&#x27; +\n  &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n  &#x27;\\tfreopen(\&quot;output.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n  &#x27;\\t\\n&#x27; +\n  &#x27;    int t;\\n&#x27; +\n  &#x27;    cin&gt;&gt;t;\\n&#x27; +\n  &#x27;    while(t--){\\n&#x27; +\n  &#x27;\\tint a,b;\\n&#x27; +\n  &#x27;    cin&gt;&gt;a&gt;&gt;b;\\n&#x27; +\n  &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n  &#x27;    }\\n&#x27; +\n  &#x27;\\n&#x27; +\n  &#x27;    \\n&#x27; +\n  &#x27;    return 0;\\n&#x27; +\n  &#x27;}&#x27;,\nfunction_def_JAVA: &#x27;public class Solution {\\n&#x27; +\n  &#x27;    public static int add(int a, int b) {\\n&#x27; +\n  &#x27;        // Write your code here.\\n&#x27; +\n  &#x27;    }\\n&#x27; +\n  &#x27;}&#x27;,\ninput_template_JAVA: &#x27;import java.io.*;\\n&#x27; +\n  &#x27;\\n&#x27; +\n  &#x27;public class Func {\\n&#x27; +\n  &#x27;    public static void main(String[] args) {\\n&#x27; +\n  &#x27;        try {\\n&#x27; +\n  &#x27;            // Open input and output files\\n&#x27; +\n  &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n  &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;output.txt\&quot;));\\n&#x27; +\n  &#x27;\\n&#x27; +\n  &#x27;\\t\\t// Read first number from input file\\n&#x27; +\n  &#x27;            String line = reader.readLine();\\n&#x27; +\n  &#x27;            int t = Integer.parseInt(line);\\n&#x27; +\n  &#x27;\\n&#x27; +\n  &#x27;\\t\\twhile(t&gt;0){\\n&#x27; +\n  &#x27;\\t\\t\\tString input = reader.readLine();\\n&#x27; +\n  &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n  &#x27;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n&#x27; +\n  &#x27;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;            \\twriter.write(Solution.add(num1,num2)+\&quot;\\\\n\&quot;);\\n&#x27; +\n  &#x27;\\t\\t\\tt--;\\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;\\t\\t}\\n&#x27; +\n  &#x27;\\t\\t// Close input and output files\\n&#x27; +\n  &#x27;            \\treader.close();\\n&#x27; +\n  &#x27;            \\twriter.close();\\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;            \\n&#x27; +\n  &#x27;        } catch (IOException e) {\\n&#x27; +\n  &#x27;            e.printStackTrace();\\n&#x27; +\n  &#x27;        }\\n&#x27; +\n  &#x27;    }\\n&#x27; +\n  &#x27;}&#x27;,\ntestcases: &#x27;5\\n1 3\\n4 6\\n2 0\\n1 -1\\n2 3&#x27;,\ntimestamp: \&quot;2023-04-28T11:21:23.840Z\&quot;,\ntags: [ &#x27;a&#x27;, &#x27;b&#x27; ],\nlevel: &#x27;medium&#x27;\n      });\nadminDB.findOne.onSecondCall().returns({problems:[]})\n      adminDB.insertOne.returns({});\n      adminDB.updateOne.returns({});\n       testProblem.handleCPP(\nproblemId,\nhandle,\ncode,\ntimestamp,\nlanguage,\nres\n      )\n      setTimeout(() =&gt; {console.log(adminDB.findOne.callCount);}, 11000);\n// expect(res.send.calledOnceWith({ success: true, message: \&quot;Accepted\&quot; })).to.be.true;\n// expect(adminDB.findOne.calledOnceWith(adminDB.problem, { _id: new ObjectId(problemId) })).to.be.true;\n// expect(adminDB.insertOne.calledOnceWith(adminDB.solution, {\n//     problemId: new ObjectId(problemId),\n//     handle: handle,\n//     code: code,\n//     timestamp: timestamp,\n//     language: language,\n//     verdict: \&quot;Accepted\&quot;,\n//     })).to.be.true;\n// expect(adminDB.updateOne.calledOnceWith(adminDB.solved, { handle: handle }, { $addToSet: { problems: new ObjectId(problemId) } })).to.be.false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c00094f0-f176-46c2-a1d9-6b31bf97c0a8&quot;,&quot;parentUUID&quot;:&quot;e9b63ce1-0082-44e8-a023-b0150a8422f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c00094f0-f176-46c2-a1d9-6b31bf97c0a8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13003,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bf2a2c47-03f2-4875-b590-5881ef592c0f&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;366bd12e-c90b-4122-b12b-6ce86866fbdf&quot;,&quot;title&quot;:&quot;userLogin&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogin \&quot;before each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  users: \&quot;users\&quot;,\n  findOne: stub(),\n};\nadminJWT = {\n  createToken: stub(),\n};\nreq = {\n  body: {\n    email: email,\n    password: password,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, adminJWT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7684cb0f-3e03-4c32-9dea-0493fc3a950e&quot;,&quot;parentUUID&quot;:&quot;366bd12e-c90b-4122-b12b-6ce86866fbdf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogin \&quot;after each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c9e8956a-9ab1-42c3-a1b5-e56e6102dc3e&quot;,&quot;parentUUID&quot;:&quot;366bd12e-c90b-4122-b12b-6ce86866fbdf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send success response if login is successful&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send success response if login is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:122,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = bcrypt.hashSync(req.body.password, 10);\nadminDB.findOne.resolves({\n  email: req.body.email,\n  password: hashedPassword,\n  type: type,\n  handle: handle,\n});\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nadminJWT.createToken.returns(\&quot;mockToken\&quot;);\nawait user.userLogin(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.calledOnce).to.be.true;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.true;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: true,\n  message: \&quot;Login Successful\&quot;,\n  type: type,\n  userToken: \&quot;mockToken\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f305ec8d-05f1-4235-a068-5474000d4b8b&quot;,&quot;parentUUID&quot;:&quot;366bd12e-c90b-4122-b12b-6ce86866fbdf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if password does not match&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send error response if password does not match&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:102,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = bcrypt.hashSync(\&quot;\&quot;, 10);\nadminDB.findOne.resolves({\n  email: req.body.email,\n  password: hashedPassword,\n  type: type,\n  handle: handle,\n});\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nawait user.userLogin(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.calledOnce).to.be.true;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.false;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Invalid Email or Password\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;28df167c-39de-4060-884b-8b52b41e2e79&quot;,&quot;parentUUID&quot;:&quot;366bd12e-c90b-4122-b12b-6ce86866fbdf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.resolves(null);\nawait user.userLogin(req, res);\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.called).to.be.false;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.false;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Invalid Email or Password\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bdfacdb6-980b-4176-a006-1f07e1b05695&quot;,&quot;parentUUID&quot;:&quot;366bd12e-c90b-4122-b12b-6ce86866fbdf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if an error occurs&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send error response if an error occurs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.rejects(new Error(\&quot;Database error\&quot;));\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nawait user.userLogin(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.called).to.be.false;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.false;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Database error\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3cc2135f-1673-49dd-8eb9-155bea2714ce&quot;,&quot;parentUUID&quot;:&quot;366bd12e-c90b-4122-b12b-6ce86866fbdf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f305ec8d-05f1-4235-a068-5474000d4b8b&quot;,&quot;28df167c-39de-4060-884b-8b52b41e2e79&quot;,&quot;bdfacdb6-980b-4176-a006-1f07e1b05695&quot;,&quot;3cc2135f-1673-49dd-8eb9-155bea2714ce&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:226,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1e3745a0-faa6-4eb1-88d8-696bb202624c&quot;,&quot;title&quot;:&quot;getUserDetails&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails \&quot;before each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  users: \&quot;users\&quot;,\n  findOne: stub(),\n};\nadminJWT = {\n  verifyToken: stub(),\n};\nreq = {\n  body: {\n    userToken: \&quot;mockToken\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, adminJWT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b9bc6905-b938-4c14-98ed-04841b4962e7&quot;,&quot;parentUUID&quot;:&quot;1e3745a0-faa6-4eb1-88d8-696bb202624c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails \&quot;after each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;76c766d3-f76c-47cb-bf47-8c5243930783&quot;,&quot;parentUUID&quot;:&quot;1e3745a0-faa6-4eb1-88d8-696bb202624c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send user details if token is valid and user exists&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send user details if token is valid and user exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodedToken = {\n  email: email,\n};\nadminJWT.verifyToken.returns(decodedToken);\nadminDB.findOne.resolves({ email: decodedToken.email });\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: decodedToken.email },\n    { password: 0, _id: 0 }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;User Details\&quot;,\n    user: { email: decodedToken.email },\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b69ef70d-4b99-49da-bf6d-f49bcb215a43&quot;,&quot;parentUUID&quot;:&quot;1e3745a0-faa6-4eb1-88d8-696bb202624c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if token is expired&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send error response if token is expired&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tokenExpiredError = new jwt.TokenExpiredError(\&quot;Token has expired\&quot;);\nadminJWT.verifyToken.throws(tokenExpiredError);\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d608ebea-6460-4b64-ad75-959aef97a356&quot;,&quot;parentUUID&quot;:&quot;1e3745a0-faa6-4eb1-88d8-696bb202624c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if token is invalid&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send error response if token is invalid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const jsonWebTokenError = new jwt.JsonWebTokenError(\&quot;Invalid token\&quot;);\nadminJWT.verifyToken.throws(jsonWebTokenError);\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User has logged out.Kindly login again\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d07b6117-5f80-4673-9e9d-580735807d8f&quot;,&quot;parentUUID&quot;:&quot;1e3745a0-faa6-4eb1-88d8-696bb202624c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if an error occurs&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send error response if an error occurs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = \&quot;Database error\&quot;;\nadminJWT.verifyToken.throws(new Error(errorMessage));\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: errorMessage,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;095d3921-24aa-484f-b9ed-ce22e1907424&quot;,&quot;parentUUID&quot;:&quot;1e3745a0-faa6-4eb1-88d8-696bb202624c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b69ef70d-4b99-49da-bf6d-f49bcb215a43&quot;,&quot;d608ebea-6460-4b64-ad75-959aef97a356&quot;,&quot;d07b6117-5f80-4673-9e9d-580735807d8f&quot;,&quot;095d3921-24aa-484f-b9ed-ce22e1907424&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;73e726cd-7cfa-48de-bf26-b8f28f9cb71a&quot;,&quot;title&quot;:&quot;updateProfile&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;fullTitle&quot;:&quot;User updateProfile \&quot;before each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: stub(),\n  updateOne: stub(),\n  users: \&quot;users\&quot;,\n};\nadminJWT = {\n  verifyToken: stub(),\n};\nreq = {\n  body: {\n    userToken: userToken,\n    city: city,\n    birthdate: birthdate,\n    address: address,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, adminJWT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e5e2a100-f3be-480f-8eaa-fd288a5b6e02&quot;,&quot;parentUUID&quot;:&quot;73e726cd-7cfa-48de-bf26-b8f28f9cb71a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;fullTitle&quot;:&quot;User updateProfile \&quot;after each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;269a5173-2811-48e3-8ca3-8fe0c2632d52&quot;,&quot;parentUUID&quot;:&quot;73e726cd-7cfa-48de-bf26-b8f28f9cb71a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should update profile if user exists and token is valid&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should update profile if user exists and token is valid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodedToken = {\n  email: email,\n};\nadminJWT.verifyToken.returns(decodedToken);\nadminDB.findOne.resolves({ email: decodedToken.email });\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: decodedToken.email,\n  })\n).to.be.true;\nexpect(\n  adminDB.updateOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: decodedToken.email },\n    {\n      $set: {\n        city: req.body.city,\n        birthdate: req.body.birthdate,\n        address: req.body.address,\n      },\n    }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;Profile Updated Successfully\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;65280cd8-53a1-45a1-bf41-f674a50e6a47&quot;,&quot;parentUUID&quot;:&quot;73e726cd-7cfa-48de-bf26-b8f28f9cb71a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if token is expired&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should send error response if token is expired&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tokenExpiredError = new TokenExpiredError(\&quot;Token has expired\&quot;);\ntokenExpiredError.name = \&quot;TokenExpiredError\&quot;;\nadminJWT.verifyToken.throws(tokenExpiredError);\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb249612-156b-4d52-a03f-8d23ad2dba9f&quot;,&quot;parentUUID&quot;:&quot;73e726cd-7cfa-48de-bf26-b8f28f9cb71a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if an error occurs during update&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should send error response if an error occurs during update&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = \&quot;Database error\&quot;;\nadminJWT.verifyToken.throws(new Error(errorMessage));\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Profile Updation Failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1ea510ac-3ce4-4e02-b243-d254835166e3&quot;,&quot;parentUUID&quot;:&quot;73e726cd-7cfa-48de-bf26-b8f28f9cb71a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodedToken = {\n  email: \&quot;test@example.com\&quot;,\n};\nadminJWT.verifyToken.returns(decodedToken);\nadminDB.findOne.resolves(null);\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: decodedToken.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User does not exists\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;eac2f317-7846-4d75-a594-1d2fcb3e9b73&quot;,&quot;parentUUID&quot;:&quot;73e726cd-7cfa-48de-bf26-b8f28f9cb71a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;65280cd8-53a1-45a1-bf41-f674a50e6a47&quot;,&quot;bb249612-156b-4d52-a03f-8d23ad2dba9f&quot;,&quot;1ea510ac-3ce4-4e02-b243-d254835166e3&quot;,&quot;eac2f317-7846-4d75-a594-1d2fcb3e9b73&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;30a50d23-198a-4d6b-89d0-2dca489a77b0&quot;,&quot;title&quot;:&quot;fillDetails&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User fillDetails \&quot;before each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: stub(),\n  insertOne: stub(),\n  users: \&quot;users\&quot;,\n};\nreq = {\n  body: {\n    email: email,\n    password: password,\n    name: \&quot;user\&quot;,\n    handle: handle,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;564806af-5bdf-4438-8f54-03b3a294af28&quot;,&quot;parentUUID&quot;:&quot;30a50d23-198a-4d6b-89d0-2dca489a77b0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User fillDetails \&quot;after each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6a180988-88d4-44f4-956f-77690ff76941&quot;,&quot;parentUUID&quot;:&quot;30a50d23-198a-4d6b-89d0-2dca489a77b0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send error response if user already exists&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if user already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const existingUser = {\n  email: req.body.email,\n};\nadminDB.findOne.resolves(existingUser);\nawait user.fillDetails(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User already exists\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5981df48-ea51-4987-bfd9-f176ec07a591&quot;,&quot;parentUUID&quot;:&quot;30a50d23-198a-4d6b-89d0-2dca489a77b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if any required detail is missing&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if any required detail is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body.email = \&quot;\&quot;;\nreq.body.password = \&quot;\&quot;;\nreq.body.name = \&quot;\&quot;;\nreq.body.handle = \&quot;\&quot;;\nawait user.fillDetails(req, res);\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Please fill all the details.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2e5f1c6a-0dc9-4a3d-88c5-400ab2f6bd99&quot;,&quot;parentUUID&quot;:&quot;30a50d23-198a-4d6b-89d0-2dca489a77b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if bcrypt hash fails&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if bcrypt hash fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = \&quot;Bcrypt hash failed\&quot;;\nstub(bcrypt, \&quot;hash\&quot;).yields(new Error(errorMessage));\nawait user.fillDetails(req, res);\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User Registration Failed due to some internal error.\&quot;,\n  })\n).to.be.true;\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d2e0088f-12ef-4043-b174-41049482246b&quot;,&quot;parentUUID&quot;:&quot;30a50d23-198a-4d6b-89d0-2dca489a77b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should register the user if all details are provided and user does not exist&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should register the user if all details are provided and user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = \&quot;hashedPassword\&quot;;\nconst newUser = {\n  email: req.body.email,\n  password: hashedPassword,\n  name: req.body.name,\n  handle: req.body.handle,\n  type: \&quot;0\&quot;,\n  city: null,\n  birthdate: null,\n  address: null,\n};\nstub(bcrypt, \&quot;hash\&quot;).callsFake((_password, _len, callback) =&gt; {\n  callback(null, hashedPassword);\n});\nadminDB.findOne.resolves(null);\nawait user.fillDetails(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(bcrypt.hash.called).to.be.true;\nexpect(adminDB.insertOne.calledWithExactly(adminDB.users, newUser)).to.be\n  .true;\nexpect(\n  adminDB.insertOne.calledWithExactly(adminDB.solved, {\n    handle: req.body.handle,\n    problems: [],\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;User Registered Successfully\&quot;,\n  })\n).to.be.true;\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61f3402d-643d-40e4-a474-0c454a6f7642&quot;,&quot;parentUUID&quot;:&quot;30a50d23-198a-4d6b-89d0-2dca489a77b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user registration fails&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if user registration fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = \&quot;hashedPassword\&quot;;\nstub(bcrypt, \&quot;hash\&quot;).callsFake((_password, _len, callback) =&gt; {\n  callback(null, hashedPassword);\n});\nadminDB.findOne.resolves(null);\nadminDB.insertOne.throws(new Error(\&quot;Database error\&quot;));\nawait user.fillDetails(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(bcrypt.hash.called).to.be.true;\nexpect(\n  adminDB.insertOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n    password: hashedPassword,\n    name: req.body.name,\n    handle: req.body.handle,\n    type: \&quot;0\&quot;,\n    city: null,\n    birthdate: null,\n    address: null,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User Registration Failed\&quot;,\n  })\n).to.be.true;\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5d9f041b-b211-4f14-bd05-e4065b9adbfd&quot;,&quot;parentUUID&quot;:&quot;30a50d23-198a-4d6b-89d0-2dca489a77b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5981df48-ea51-4987-bfd9-f176ec07a591&quot;,&quot;2e5f1c6a-0dc9-4a3d-88c5-400ab2f6bd99&quot;,&quot;d2e0088f-12ef-4043-b174-41049482246b&quot;,&quot;61f3402d-643d-40e4-a474-0c454a6f7642&quot;,&quot;5d9f041b-b211-4f14-bd05-e4065b9adbfd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7e109dfc-0d63-45ee-88cd-0feb42d1faf1&quot;,&quot;title&quot;:&quot;verifyOTP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;verifyOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP \&quot;before each\&quot; hook in \&quot;verifyOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: stub(),\n  deleteOne: stub(),\n  otp: \&quot;otp\&quot;,\n};\nreq = {\n  body: {\n    email: email,\n    otp: otp,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, {}, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9455fdc1-4bb0-4f13-ad83-c84cc01889a0&quot;,&quot;parentUUID&quot;:&quot;7e109dfc-0d63-45ee-88cd-0feb42d1faf1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send success response if OTP matches&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP should send success response if OTP matches&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.resolves({\n  email: req.body.email,\n  otp: req.body.otp,\n});\nawait user.verifyOTP(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  adminDB.deleteOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;OTP Verified Successfully\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c4ea0a8e-c498-43cd-a32b-08e2294a0baa&quot;,&quot;parentUUID&quot;:&quot;7e109dfc-0d63-45ee-88cd-0feb42d1faf1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if OTP does not match&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP should send error response if OTP does not match&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.resolves({\n  email: req.body.email,\n  otp: \&quot;wrongOTP\&quot;,\n});\nawait user.verifyOTP(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Invalid OTP\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cc3d86de-a2f7-43af-9dac-f0db976532ed&quot;,&quot;parentUUID&quot;:&quot;7e109dfc-0d63-45ee-88cd-0feb42d1faf1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if OTP verification fails&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP should send error response if OTP verification fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.throws(new Error(\&quot;Database error\&quot;));\nawait user.verifyOTP(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;OTP Verification Failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b2bb6733-86e2-4415-a417-27e642433655&quot;,&quot;parentUUID&quot;:&quot;7e109dfc-0d63-45ee-88cd-0feb42d1faf1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c4ea0a8e-c498-43cd-a32b-08e2294a0baa&quot;,&quot;cc3d86de-a2f7-43af-9dac-f0db976532ed&quot;,&quot;b2bb6733-86e2-4415-a417-27e642433655&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f7c505ce-90c2-4e7d-85f6-04d5a5765e7d&quot;,&quot;title&quot;:&quot;sendOTP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;User sendOTP \&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = { body: { email: email } };\nres = {\n  send: stub(),\n};\n// Mocking adminDB and adminMail objects\nadminDB = {\n  findOne: stub(),\n  updateOne: stub(),\n  insertOne: stub(),\n  users: \&quot;users\&quot;,\n  otp: \&quot;otp\&quot;,\n};\nadminMail = {\n  sendOTP: stub(),\n};\n// Importing the sendOTP function\nuser = new User(adminDB, {}, adminMail);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;985aa19e-e9e7-415a-9e45-528c62c84553&quot;,&quot;parentUUID&quot;:&quot;f7c505ce-90c2-4e7d-85f6-04d5a5765e7d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send OTP and respond with success message if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should send OTP and respond with success message if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to return null (user does not exist)\nadminDB.findOne.returns(null);\nconst mathRandomStub = stub(Math, \&quot;random\&quot;).returns(0.5);\nconst mathFloorStub = stub(Math, \&quot;floor\&quot;).returns(500000);\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(adminDB.findOne.callCount).to.equal(2);\nexpect(\n  adminDB.findOne.calledWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(mathRandomStub.calledOnce).to.be.true;\nexpect(mathFloorStub.calledOnce).to.be.true;\nexpect(adminMail.sendOTP.calledOnceWith(req.body.email, 500000)).to.be\n  .true;\nexpect(\n  adminDB.findOne.calledWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  adminDB.insertOne.calledOnceWith(adminDB.otp, {\n    email: req.body.email,\n    otp: 500000,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: true,\n    message: \&quot;OTP Sent Successfully\&quot;,\n  })\n).to.be.true;\nmathRandomStub.restore();\nmathFloorStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;82e67582-11b9-4b4f-9103-08f4d604df76&quot;,&quot;parentUUID&quot;:&quot;f7c505ce-90c2-4e7d-85f6-04d5a5765e7d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send OTP and respond with success message if otp exists in the otp collection&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should send OTP and respond with success message if otp exists in the otp collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to return null (user does not exist)\nadminDB.findOne.onCall(0).returns(null);\nadminDB.findOne.onCall(1).returns(true);\nconst mathRandomStub = stub(Math, \&quot;random\&quot;).returns(0.5);\nconst mathFloorStub = stub(Math, \&quot;floor\&quot;).returns(500000);\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(mathRandomStub.calledOnce).to.be.true;\nexpect(mathFloorStub.calledOnce).to.be.true;\nexpect(adminMail.sendOTP.calledOnceWith(req.body.email, 500000)).to.be\n  .true;\nexpect(\n  adminDB.updateOne.calledOnceWith(\n    adminDB.otp,\n    { email: email },\n    { $set: { otp: 500000 } }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: true,\n    message: \&quot;OTP Sent Successfully\&quot;,\n  })\n).to.be.true;\nmathRandomStub.restore();\nmathFloorStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c04f7a70-e095-49a2-8901-d1dc3c239368&quot;,&quot;parentUUID&quot;:&quot;f7c505ce-90c2-4e7d-85f6-04d5a5765e7d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user already exists&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should send error response if user already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to return a user (user already exists)\nadminDB.findOne.returns({ email: email });\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(adminMail.sendOTP.notCalled).to.be.true;\nexpect(adminDB.insertOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;User already exists\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;183b6bcc-dc6d-4a75-9cee-e577a9720c2d&quot;,&quot;parentUUID&quot;:&quot;f7c505ce-90c2-4e7d-85f6-04d5a5765e7d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors and respond with failure message&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should handle errors and respond with failure message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to throw an error\nadminDB.findOne.throws(new Error(\&quot;Database error\&quot;));\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(adminMail.sendOTP.notCalled).to.be.true;\nexpect(adminDB.insertOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;OTP generation failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;115516a5-e73e-4494-a25c-6efcd9acf8e4&quot;,&quot;parentUUID&quot;:&quot;f7c505ce-90c2-4e7d-85f6-04d5a5765e7d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;82e67582-11b9-4b4f-9103-08f4d604df76&quot;,&quot;c04f7a70-e095-49a2-8901-d1dc3c239368&quot;,&quot;183b6bcc-dc6d-4a75-9cee-e577a9720c2d&quot;,&quot;115516a5-e73e-4494-a25c-6efcd9acf8e4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:6,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ee164260-1567-42dd-a010-df59a5e43a4b&quot;,&quot;title&quot;:&quot;changePassword&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;changePassword\&quot;&quot;,&quot;fullTitle&quot;:&quot;User changePassword \&quot;before each\&quot; hook in \&quot;changePassword\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req = { body: { email: email, newPassword: newpassword } };\nres = {\n  send: stub(),\n};\nadminDB = {\n  findOne: stub(),\n  updateOne: stub(),\n  users: \&quot;users\&quot;,\n};\nuser = new User(adminDB, {}, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d588defe-fe20-4e7d-8436-5f07a65b1ff4&quot;,&quot;parentUUID&quot;:&quot;ee164260-1567-42dd-a010-df59a5e43a4b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should change password and respond with success message if user exists&quot;,&quot;fullTitle&quot;:&quot;User changePassword should change password and respond with success message if user exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.returns({ email: email });\nconst bcryptHashStub = stub(bcrypt, \&quot;hash\&quot;)\n  .callsArgWith(2, null, hash);\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(bcrypt.hash.calledOnceWith(req.body.newPassword, 10)).to.be.true;\nexpect(\n  adminDB.updateOne.calledOnceWith(\n    adminDB.users,\n    { email: req.body.email },\n    { $set: { password: hash } }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: true,\n    message: \&quot;Password Changed Successfully.\&quot;,\n  })\n).to.be.true;\nbcryptHashStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a578a562-562a-4f40-ada1-dc3c0e9a009c&quot;,&quot;parentUUID&quot;:&quot;ee164260-1567-42dd-a010-df59a5e43a4b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if bcrypt.hash encounters an error&quot;,&quot;fullTitle&quot;:&quot;User changePassword should send error response if bcrypt.hash encounters an error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.returns({ email: email });\nconst bcryptHashStub = stub(bcrypt, \&quot;hash\&quot;)\n  .callsArgWith(2, new Error(\&quot;Hashing error\&quot;));\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(bcrypt.hash.calledOnceWith(req.body.newPassword, 10)).to.be.true;\nexpect(adminDB.updateOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Password Updation Failed due to some internal error.\&quot;,\n  })\n).to.be.true;\nbcryptHashStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ddcf4136-1ad8-450c-baf9-8d13000f1d50&quot;,&quot;parentUUID&quot;:&quot;ee164260-1567-42dd-a010-df59a5e43a4b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User changePassword should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.returns(null);\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(adminDB.updateOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;User does not exists.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb74987c-a135-430d-9dcd-341ee82ec8f4&quot;,&quot;parentUUID&quot;:&quot;ee164260-1567-42dd-a010-df59a5e43a4b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors and respond with failure message&quot;,&quot;fullTitle&quot;:&quot;User changePassword should handle errors and respond with failure message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.throws(new Error(\&quot;Database error\&quot;));\nconst bcryptHashStub = stub(bcrypt, \&quot;hash\&quot;)\n  .callsArgWith(2, new Error(\&quot;Hashing error\&quot;));\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(bcrypt.hash.notCalled).to.be.true;\nexpect(adminDB.updateOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Password Updation Failed due to some internal error.\&quot;,\n  })\n).to.be.true;\nbcryptHashStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;35be432c-7a19-46f7-b5d4-7824e0347401&quot;,&quot;parentUUID&quot;:&quot;ee164260-1567-42dd-a010-df59a5e43a4b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a578a562-562a-4f40-ada1-dc3c0e9a009c&quot;,&quot;ddcf4136-1ad8-450c-baf9-8d13000f1d50&quot;,&quot;bb74987c-a135-430d-9dcd-341ee82ec8f4&quot;,&quot;35be432c-7a19-46f7-b5d4-7824e0347401&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2d6e6bc6-78d8-4237-942d-3946e51a1fd4&quot;,&quot;title&quot;:&quot;userLogout&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogout \&quot;before each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = { body: { userToken: &#x27;validToken&#x27; } };\nres = {\n  send: stub(),\n};\n  \n// Mocking adminJWT and adminDB objects\nadminJWT = {\n  verifyToken: stub(),\n};\n  \nadminDB = {\n  findOne: stub(),\n  users: &#x27;users&#x27;,\n};\n\n// Importing the userLogout function\nuser = new User(adminDB, adminJWT, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8d917ec5-862e-4455-bd42-695663e80072&quot;,&quot;parentUUID&quot;:&quot;2d6e6bc6-78d8-4237-942d-3946e51a1fd4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogout \&quot;after each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions to their original implementation\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e2fef353-541c-4231-a16b-e46730505746&quot;,&quot;parentUUID&quot;:&quot;2d6e6bc6-78d8-4237-942d-3946e51a1fd4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send success response if user exists&quot;,&quot;fullTitle&quot;:&quot;User userLogout should send success response if user exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return email\nadminJWT.verifyToken.returns({ email: email });\n  \n// Stubbing adminDB.findOne to return user data\nadminDB.findOne.returns({ email: email });\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(adminDB.findOne.calledOnceWith(adminDB.users, { email: email })).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: true,\n  message: &#x27;User Logged Out Successfully&#x27;,\n  userToken: &#x27;&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d41693c5-e014-4e3a-b7a3-01ee4b2e9eec&quot;,&quot;parentUUID&quot;:&quot;2d6e6bc6-78d8-4237-942d-3946e51a1fd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User userLogout should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return email\nadminJWT.verifyToken.returns({ email: email });\n  \n// Stubbing adminDB.findOne to return null (user does not exist)\nadminDB.findOne.returns(null);\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(adminDB.findOne.calledOnceWith(adminDB.users, { email: email })).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;User does not exists&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c0796739-305c-494d-979c-33618469eee4&quot;,&quot;parentUUID&quot;:&quot;2d6e6bc6-78d8-4237-942d-3946e51a1fd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle TokenExpiredError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;User userLogout should handle TokenExpiredError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw TokenExpiredError\nadminJWT.verifyToken.throws(new TokenExpiredError(&#x27;Token expired&#x27;));\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;User has been logged out.&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e639b23f-4c8e-433e-8b91-6fccdae2df85&quot;,&quot;parentUUID&quot;:&quot;2d6e6bc6-78d8-4237-942d-3946e51a1fd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle JsonWebTokenError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;User userLogout should handle JsonWebTokenError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw JsonWebTokenError\nadminJWT.verifyToken.throws(new JsonWebTokenError(&#x27;Invalid token&#x27;));\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: \&quot;User has logged out.Kindly login again\&quot;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4579b074-75ab-487d-8efb-26fd37d97774&quot;,&quot;parentUUID&quot;:&quot;2d6e6bc6-78d8-4237-942d-3946e51a1fd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;User userLogout should handle other errors and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(&#x27;Some error&#x27;));\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Some error&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;30591e3f-2cd2-476f-bb55-d6cfeb7b40c4&quot;,&quot;parentUUID&quot;:&quot;2d6e6bc6-78d8-4237-942d-3946e51a1fd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d41693c5-e014-4e3a-b7a3-01ee4b2e9eec&quot;,&quot;c0796739-305c-494d-979c-33618469eee4&quot;,&quot;e639b23f-4c8e-433e-8b91-6fccdae2df85&quot;,&quot;4579b074-75ab-487d-8efb-26fd37d97774&quot;,&quot;30591e3f-2cd2-476f-bb55-d6cfeb7b40c4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b19fb3d9-48f4-403a-8b02-5caf4f82a62e&quot;,&quot;title&quot;:&quot;getAllHandles&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles \&quot;before each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {};\nres = {\n  send: stub(),\n};\n  \n// Mocking adminDB object\nadminDB = {\n  find: stub(),\n  users: &#x27;users&#x27;,\n};\n  \nuser = new User(adminDB, {}, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6c39604e-8cff-49c5-8253-3e599896c9b0&quot;,&quot;parentUUID&quot;:&quot;b19fb3d9-48f4-403a-8b02-5caf4f82a62e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles \&quot;after each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions to their original implementation\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bc09ba05-4904-49c1-bc37-a204d30b4bad&quot;,&quot;parentUUID&quot;:&quot;b19fb3d9-48f4-403a-8b02-5caf4f82a62e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should fetch all handles and send success response&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles should fetch all handles and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.find to return user data\nconst users = [\n  { handle: &#x27;handle1&#x27; },\n  { handle: &#x27;handle2&#x27; },\n  { handle: &#x27;handle3&#x27; },\n];\nadminDB.find.returns(users);\n  \n// Calling the getAllHandles function\nawait user.getAllHandles(req, res);\n  \n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.users, {})).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: true,\n  message: &#x27;All Handles&#x27;,\n  handles: [&#x27;handle1&#x27;, &#x27;handle2&#x27;, &#x27;handle3&#x27;],\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a906c3ae-85d0-411b-9def-7b05ecbb8fbb&quot;,&quot;parentUUID&quot;:&quot;b19fb3d9-48f4-403a-8b02-5caf4f82a62e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors and send error response&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles should handle errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.find to throw an error\nadminDB.find.throws(new Error(&#x27;Database error&#x27;));\n  \n// Calling the getAllHandles function\nawait user.getAllHandles(req, res);\n  \n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.users, {})).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Error in fetching handles&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c05e761e-f177-409f-9ae3-0024df94b6ed&quot;,&quot;parentUUID&quot;:&quot;b19fb3d9-48f4-403a-8b02-5caf4f82a62e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a906c3ae-85d0-411b-9def-7b05ecbb8fbb&quot;,&quot;c05e761e-f177-409f-9ae3-0024df94b6ed&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.2.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;custom-report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportFilename&quot;:&quot;custom-report&quot;,&quot;reportDir&quot;:&quot;reports&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;custom-report&quot;,&quot;reportDir&quot;:&quot;reports&quot;,&quot;reportTitle&quot;:&quot;server&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;reports/assets&quot;,&quot;jsonFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/reports/custom-report.json&quot;,&quot;htmlFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/reports/custom-report.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>